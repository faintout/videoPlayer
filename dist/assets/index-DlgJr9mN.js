import{_ as Wr,r as D,o as Ot,n as qr,a as Hr,c as je,b as Te,w as di,d as kt,e as qe,t as Jr,f as pi,F as hi,g as Vr}from"./index-CuqqjYv9.js";var fe=function($){const I={WEBRTC_NOT_SUPPORT:"WEBRTC_NOT_SUPPORT",WEBRTC_ICE_CANDIDATE_ERROR:"WEBRTC_ICE_CANDIDATE_ERROR",WEBRTC_OFFER_ANWSER_EXCHANGE_FAILED:"WEBRTC_OFFER_ANWSER_EXCHANGE_FAILED",WEBRTC_ON_REMOTE_STREAMS:"WEBRTC_ON_REMOTE_STREAMS",WEBRTC_ON_LOCAL_STREAM:"WEBRTC_ON_LOCAL_STREAM",WEBRTC_ON_CONNECTION_STATE_CHANGE:"WEBRTC_ON_CONNECTION_STATE_CHANGE",WEBRTC_ON_DATA_CHANNEL_OPEN:"WEBRTC_ON_DATA_CHANNEL_OPEN",WEBRTC_ON_DATA_CHANNEL_CLOSE:"WEBRTC_ON_DATA_CHANNEL_CLOSE",WEBRTC_ON_DATA_CHANNEL_ERR:"WEBRTC_ON_DATA_CHANNEL_ERR",WEBRTC_ON_DATA_CHANNEL_MSG:"WEBRTC_ON_DATA_CHANNEL_MSG",CAPTURE_STREAM_FAILED:"CAPTURE_STREAM_FAILED"},V="1.1.2",Q="Fri Dec 20 2024 19:12:10 GMT+0800 (China Standard Time)";function ae(){return window.navigator.userAgent.match("Firefox")!==null}function P(){return window.navigator.userAgent.match("Chrome")!==null}function Z(){return window.navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)!==null}const x={MIC:"mic",SCREENCAST:"screen-cast",FILE:"file",MIXED:"mixed"},U={CAMERA:"camera",SCREENCAST:"screen-cast",FILE:"file",MIXED:"mixed"},ue={AUDIO:"audio",VIDEO:"video",AUDIO_AND_VIDEO:"av"};class se{constructor(e,r){this.width=e,this.height=r}}let W=!0,oe=!0;function re(t,e,r){const n=t.match(e);return n&&n.length>=r&&parseInt(n[r],10)}function w(t,e,r){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(c,l){if(c!==e)return i.apply(this,arguments);const s=o=>{const u=r(o);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,s),i.apply(this,[c,s])};const a=n.removeEventListener;n.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return a.apply(this,arguments);if(!this._eventMap[e].has(l))return a.apply(this,arguments);const s=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,s])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function Y(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(W=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function L(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(oe=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Pe(){if(typeof window=="object"){if(W)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ne(t,e){oe&&console.warn(t+" is deprecated, please use "+e+" instead.")}function k(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator)return e.browser="Not a browser.",e;const{navigator:r}=t;if(r.mozGetUserMedia)e.browser="firefox",e.version=re(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection&&!t.RTCIceGatherer)e.browser="chrome",e.version=re(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=re(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(t.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=re(r.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function be(t){return Object.prototype.toString.call(t)==="[object Object]"}function Dt(t){return be(t)?Object.keys(t).reduce(function(e,r){const n=be(t[r]),i=n?Dt(t[r]):t[r],a=n&&!Object.keys(i).length;return i===void 0||a?e:Object.assign(e,{[r]:i})},{}):t}function st(t,e,r){!e||r.has(e.id)||(r.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?st(t,t.get(e[n]),r):n.endsWith("Ids")&&e[n].forEach(i=>{st(t,t.get(i),r)})}))}function xt(t,e,r){const n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const a=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&a.push(c)}),a.forEach(c=>{t.forEach(l=>{l.type===n&&l.trackId===c.id&&st(t,l,i)})}),i}const Mt=Pe;function Nt(t,e){const r=t&&t.navigator;if(!r.mediaDevices)return;const n=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const s={};return Object.keys(l).forEach(o=>{if(o==="require"||o==="advanced"||o==="mediaSource")return;const u=typeof l[o]=="object"?l[o]:{ideal:l[o]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const f=function(d,m){return d?d+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){s.optional=s.optional||[];let d={};typeof u.ideal=="number"?(d[f("min",o)]=u.ideal,s.optional.push(d),d={},d[f("max",o)]=u.ideal,s.optional.push(d)):(d[f("",o)]=u.ideal,s.optional.push(d))}u.exact!==void 0&&typeof u.exact!="number"?(s.mandatory=s.mandatory||{},s.mandatory[f("",o)]=u.exact):["min","max"].forEach(d=>{u[d]!==void 0&&(s.mandatory=s.mandatory||{},s.mandatory[f(d,o)]=u[d])})}),l.advanced&&(s.optional=(s.optional||[]).concat(l.advanced)),s},i=function(l,s){if(e.version>=61)return s(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const o=function(u,f,d){f in u&&!(d in u)&&(u[d]=u[f],delete u[f])};l=JSON.parse(JSON.stringify(l)),o(l.audio,"autoGainControl","googAutoGainControl"),o(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=n(l.audio)}if(l&&typeof l.video=="object"){let o=l.video.facingMode;o=o&&(typeof o=="object"?o:{ideal:o});const u=e.version<66;if(o&&(o.exact==="user"||o.exact==="environment"||o.ideal==="user"||o.ideal==="environment")&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let f;if(o.exact==="environment"||o.ideal==="environment"?f=["back","rear"]:(o.exact==="user"||o.ideal==="user")&&(f=["front"]),f)return r.mediaDevices.enumerateDevices().then(d=>{d=d.filter(h=>h.kind==="videoinput");let m=d.find(h=>f.some(T=>h.label.toLowerCase().includes(T)));return!m&&d.length&&f.includes("back")&&(m=d[d.length-1]),m&&(l.video.deviceId=o.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=n(l.video),Mt("chrome: "+JSON.stringify(l)),s(l)})}l.video=n(l.video)}return Mt("chrome: "+JSON.stringify(l)),s(l)},a=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(l,s,o){i(l,u=>{r.webkitGetUserMedia(u,s,f=>{o&&o(a(f))})})};if(r.getUserMedia=c.bind(r),r.mediaDevices.getUserMedia){const l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(s){return i(s,o=>l(o).then(u=>{if(o.audio&&!u.getAudioTracks().length||o.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(a(u))))}}}function $r(t,e){if(!(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices)&&t.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const a=n.video&&n.video.width,c=n.video&&n.video.height,l=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:l||3}},a&&(n.video.mandatory.maxWidth=a),c&&(n.video.mandatory.maxHeight=c),t.navigator.mediaDevices.getUserMedia(n)})}}}function It(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Lt(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let a;t.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):a={track:i.track};const c=new Event("track");c.track=i.track,c.receiver=a,c.transceiver={receiver:a},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(i=>{let a;t.RTCPeerConnection.prototype.getReceivers?a=this.getReceivers().find(l=>l.track&&l.track.id===i.id):a={track:i};const c=new Event("track");c.track=i,c.receiver=a,c.transceiver={receiver:a},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else w(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function jt(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=i.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,s){let o=i.apply(this,arguments);return o||(o=e(this,l),this._senders.push(o)),o};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){a.apply(this,arguments);const s=this._senders.indexOf(l);s!==-1&&this._senders.splice(s,1)}}const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],r.apply(this,[a]),a.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],n.apply(this,[a]),a.getTracks().forEach(c=>{const l=this._senders.find(s=>s.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ft(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,a]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const c=function(s){const o={};return s.result().forEach(f=>{const d={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(m=>{d[m]=f.stat(m)}),o[d.id]=d}),o},l=function(s){return new Map(Object.keys(s).map(o=>[o,s[o]]))};if(arguments.length>=2){const s=function(o){i(l(c(o)))};return e.apply(this,[s,n])}return new Promise((s,o)=>{e.apply(this,[function(u){s(l(c(u)))},o])}).then(i,a)}}function Gt(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>xt(c,a.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(a=>a._pc=this),i}),w(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(a=>xt(a,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,a,c;return this.getSenders().forEach(l=>{l.track===n&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===n&&(a?c=!0:a=l),l.track===n)),c||i&&a?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():a?a.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Ut(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const s=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(s)===-1&&this._shimmedLocalStreams[l.id].push(s):this._shimmedLocalStreams[l.id]=[l,s],s};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(o=>{if(this.getSenders().find(f=>f.track===o))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();r.apply(this,arguments);const s=this.getSenders().filter(o=>l.indexOf(o)===-1);this._shimmedLocalStreams[c.id]=[c].concat(s)};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],n.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const s=this._shimmedLocalStreams[l].indexOf(c);s!==-1&&this._shimmedLocalStreams[l].splice(s,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function Bt(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Ut(t);const r=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=r.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(f=>this._reverseStreams[f.id])};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const f=new t.MediaStream(u.getTracks());this._streams[u.id]=f,this._reverseStreams[f.id]=u,u=f}n.apply(this,[u])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(T=>T===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[f.id];if(h)h.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new t.MediaStream([u]);this._streams[f.id]=T,this._reverseStreams[T.id]=f,this.addStream(T)}return this.getSenders().find(T=>T.track===u)};function a(o,u){let f=u.sdp;return Object.keys(o._reverseStreams||[]).forEach(d=>{const m=o._reverseStreams[d],h=o._streams[m.id];f=f.replace(new RegExp(h.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:f})}function c(o,u){let f=u.sdp;return Object.keys(o._reverseStreams||[]).forEach(d=>{const m=o._reverseStreams[d],h=o._streams[m.id];f=f.replace(new RegExp(m.id,"g"),h.id)}),new RTCSessionDescription({type:u.type,sdp:f})}["createOffer","createAnswer"].forEach(function(o){const u=t.RTCPeerConnection.prototype[o],f={[o](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[h=>{const T=a(this,h);d[0].apply(null,[T])},h=>{d[1]&&d[1].apply(null,h)},arguments[2]]):u.apply(this,arguments).then(h=>a(this,h))}};t.RTCPeerConnection.prototype[o]=f[o]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=c(this,arguments[0]),l.apply(this,arguments))};const s=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const o=s.get.apply(this);return o.type===""?o:a(this,o)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(T=>u.track===T)&&(d=this._streams[m])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ot(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const n=t.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=i[r]})}function zt(t,e){w(t,"negotiationneeded",r=>{const n=r.target;if(!((e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return r})}var Vt=Object.freeze({__proto__:null,shimMediaStream:It,shimOnTrack:Lt,shimGetSendersWithDtmf:jt,shimGetStats:Ft,shimSenderReceiverGetStats:Gt,shimAddTrackRemoveTrackWithNative:Ut,shimAddTrackRemoveTrack:Bt,shimPeerConnection:ot,fixNegotiationNeeded:zt,shimGetUserMedia:Nt,shimGetDisplayMedia:$r});function Kr(t,e){let r=!1;return t=JSON.parse(JSON.stringify(t)),t.filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&ne("RTCIceServer.url","RTCIceServer.urls");const a=typeof i=="string";return a&&(i=[i]),i=i.filter(c=>{if(c.indexOf("stun:")===0)return!1;const l=c.startsWith("turn")&&!c.startsWith("turn:[")&&c.includes("transport=udp");return l&&!r?(r=!0,!0):l&&!r}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wt(t){var e={exports:{}};return t(e,e.exports),e.exports}function Xr(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var R=Wt(function(t){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(r){return r.trim().split(`
`).map(function(n){return n.trim()})},e.splitSections=function(r){var n=r.split(`
m=`);return n.map(function(i,a){return(a>0?"m="+i:i).trim()+`\r
`})},e.getDescription=function(r){var n=e.splitSections(r);return n&&n[0]},e.getMediaSections=function(r){var n=e.splitSections(r);return n.shift(),n},e.matchPrefix=function(r,n){return e.splitLines(r).filter(function(i){return i.indexOf(n)===0})},e.parseCandidate=function(r){var n;r.indexOf("a=candidate:")===0?n=r.substring(12).split(" "):n=r.substring(10).split(" ");for(var i={foundation:n[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},a=8;a<n.length;a+=2)switch(n[a]){case"raddr":i.relatedAddress=n[a+1];break;case"rport":i.relatedPort=parseInt(n[a+1],10);break;case"tcptype":i.tcpType=n[a+1];break;case"ufrag":i.ufrag=n[a+1],i.usernameFragment=n[a+1];break;default:i[n[a]]=n[a+1];break}return i},e.writeCandidate=function(r){var n=[];n.push(r.foundation),n.push(r.component),n.push(r.protocol.toUpperCase()),n.push(r.priority),n.push(r.address||r.ip),n.push(r.port);var i=r.type;return n.push("typ"),n.push(i),i!=="host"&&r.relatedAddress&&r.relatedPort&&(n.push("raddr"),n.push(r.relatedAddress),n.push("rport"),n.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(n.push("ufrag"),n.push(r.usernameFragment||r.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(r){return r.substr(14).split(" ")},e.parseRtpMap=function(r){var n=r.substr(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(r){var n=r.payloadType;r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType);var i=r.channels||r.numChannels||1;return"a=rtpmap:"+n+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(r){var n=r.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},e.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+`\r
`},e.parseFmtp=function(r){for(var n={},i,a=r.substr(r.indexOf(" ")+1).split(";"),c=0;c<a.length;c++)i=a[c].trim().split("="),n[i[0].trim()]=i[1];return n},e.writeFmtp=function(r){var n="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){var a=[];Object.keys(r.parameters).forEach(function(c){r.parameters[c]?a.push(c+"="+r.parameters[c]):a.push(c)}),n+="a=fmtp:"+i+" "+a.join(";")+`\r
`}return n},e.parseRtcpFb=function(r){var n=r.substr(r.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(r){var n="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(function(a){n+="a=rtcp-fb:"+i+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(r){var n=r.indexOf(" "),i={ssrc:parseInt(r.substr(7,n-7),10)},a=r.indexOf(":",n);return a>-1?(i.attribute=r.substr(n+1,a-n-1),i.value=r.substr(a+1)):i.attribute=r.substr(n+1),i},e.parseSsrcGroup=function(r){var n=r.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(function(i){return parseInt(i,10)})}},e.getMid=function(r){var n=e.matchPrefix(r,"a=mid:")[0];if(n)return n.substr(6)},e.parseFingerprint=function(r){var n=r.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},e.getDtlsParameters=function(r,n){var i=e.matchPrefix(r+n,"a=fingerprint:");return{role:"auto",fingerprints:i.map(e.parseFingerprint)}},e.writeDtlsParameters=function(r,n){var i="a=setup:"+n+`\r
`;return r.fingerprints.forEach(function(a){i+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),i},e.parseCryptoLine=function(r){var n=r.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?e.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;var n=r.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},e.getCryptoParameters=function(r,n){var i=e.matchPrefix(r+n,"a=crypto:");return i.map(e.parseCryptoLine)},e.getIceParameters=function(r,n){var i=e.matchPrefix(r+n,"a=ice-ufrag:")[0],a=e.matchPrefix(r+n,"a=ice-pwd:")[0];return i&&a?{usernameFragment:i.substr(12),password:a.substr(10)}:null},e.writeIceParameters=function(r){return"a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`},e.parseRtpParameters=function(r){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(r),a=i[0].split(" "),c=3;c<a.length;c++){var l=a[c],s=e.matchPrefix(r,"a=rtpmap:"+l+" ")[0];if(s){var o=e.parseRtpMap(s),u=e.matchPrefix(r,"a=fmtp:"+l+" ");switch(o.parameters=u.length?e.parseFmtp(u[0]):{},o.rtcpFeedback=e.matchPrefix(r,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),n.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(o.name.toUpperCase());break}}}return e.matchPrefix(r,"a=extmap:").forEach(function(f){n.headerExtensions.push(e.parseExtmap(f))}),n},e.writeRtpDescription=function(r,n){var i="";i+="m="+r+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map(function(c){return c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType}).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(function(c){i+=e.writeRtpMap(c),i+=e.writeFmtp(c),i+=e.writeRtcpFb(c)});var a=0;return n.codecs.forEach(function(c){c.maxptime>a&&(a=c.maxptime)}),a>0&&(i+="a=maxptime:"+a+`\r
`),i+=`a=rtcp-mux\r
`,n.headerExtensions&&n.headerExtensions.forEach(function(c){i+=e.writeExtmap(c)}),i},e.parseRtpEncodingParameters=function(r){var n=[],i=e.parseRtpParameters(r),a=i.fecMechanisms.indexOf("RED")!==-1,c=i.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(r,"a=ssrc:").map(function(d){return e.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="cname"}),s=l.length>0&&l[0].ssrc,o,u=e.matchPrefix(r,"a=ssrc-group:FID").map(function(d){var m=d.substr(17).split(" ");return m.map(function(h){return parseInt(h,10)})});u.length>0&&u[0].length>1&&u[0][0]===s&&(o=u[0][1]),i.codecs.forEach(function(d){if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){var m={ssrc:s,codecPayloadType:parseInt(d.parameters.apt,10)};s&&o&&(m.rtx={ssrc:o}),n.push(m),a&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:s,mechanism:c?"red+ulpfec":"red"},n.push(m))}}),n.length===0&&s&&n.push({ssrc:s});var f=e.matchPrefix(r,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substr(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substr(5),10)*1e3*.95-2e3*8:f=void 0,n.forEach(function(d){d.maxBitrate=f})),n},e.parseRtcpParameters=function(r){var n={},i=e.matchPrefix(r,"a=ssrc:").map(function(l){return e.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="cname"})[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var a=e.matchPrefix(r,"a=rtcp-rsize");n.reducedSize=a.length>0,n.compound=a.length===0;var c=e.matchPrefix(r,"a=rtcp-mux");return n.mux=c.length>0,n},e.parseMsid=function(r){var n,i=e.matchPrefix(r,"a=msid:");if(i.length===1)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};var a=e.matchPrefix(r,"a=ssrc:").map(function(c){return e.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="msid"});if(a.length>0)return n=a[0].value.split(" "),{stream:n[0],track:n[1]}},e.parseSctpDescription=function(r){var n=e.parseMLine(r),i=e.matchPrefix(r,"a=max-message-size:"),a;i.length>0&&(a=parseInt(i[0].substr(19),10)),isNaN(a)&&(a=65536);var c=e.matchPrefix(r,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substr(12),10),protocol:n.fmt,maxMessageSize:a};var l=e.matchPrefix(r,"a=sctpmap:");if(l.length>0){var s=e.matchPrefix(r,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:a}}},e.writeSctpDescription=function(r,n){var i=[];return r.protocol!=="DTLS/SCTP"?i=["m="+r.kind+" 9 "+r.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:i=["m="+r.kind+" 9 "+r.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(r,n,i){var a,c=n!==void 0?n:2;r?a=r:a=e.generateSessionId();var l=i||"thisisadapterortc";return`v=0\r
o=`+l+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(r,n,i,a){var c=e.writeRtpDescription(r.kind,n);if(c+=e.writeIceParameters(r.iceGatherer.getLocalParameters()),c+=e.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":"active"),c+="a=mid:"+r.mid+`\r
`,r.direction?c+="a="+r.direction+`\r
`:r.rtpSender&&r.rtpReceiver?c+=`a=sendrecv\r
`:r.rtpSender?c+=`a=sendonly\r
`:r.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,r.rtpSender){var l="msid:"+a.id+" "+r.rtpSender.track.id+`\r
`;c+="a="+l,c+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+l,r.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+l,c+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return c+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),c},e.getDirection=function(r,n){for(var i=e.splitLines(r),a=0;a<i.length;a++)switch(i[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[a].substr(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(r){var n=e.splitLines(r),i=n[0].split(" ");return i[0].substr(2)},e.isRejected=function(r){return r.split(" ",2)[1]==="0"},e.parseMLine=function(r){var n=e.splitLines(r),i=n[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(r){var n=e.matchPrefix(r,"o=")[0],i=n.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;for(var n=e.splitLines(r),i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},t.exports=e});function Qr(t){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type}function qt(t,e,r,n,i){var a=R.writeRtpDescription(t.kind,e);if(a+=R.writeIceParameters(t.iceGatherer.getLocalParameters()),a+=R.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),r==="offer"?"actpass":i||"active"),a+="a=mid:"+t.mid+`\r
`,t.rtpSender&&t.rtpReceiver?a+=`a=sendrecv\r
`:t.rtpSender?a+=`a=sendonly\r
`:t.rtpReceiver?a+=`a=recvonly\r
`:a+=`a=inactive\r
`,t.rtpSender){var c=t.rtpSender._initialTrackId||t.rtpSender.track.id;t.rtpSender._initialTrackId=c;var l="msid:"+(n?n.id:"-")+" "+c+`\r
`;a+="a="+l,a+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+l,t.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+l,a+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return a+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+R.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+R.localCName+`\r
`),a}function Yr(t,e){var r=!1;return t=JSON.parse(JSON.stringify(t)),t.filter(function(n){if(n&&(n.urls||n.url)){var i=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var a=typeof i=="string";return a&&(i=[i]),i=i.filter(function(c){var l=c.indexOf("turn:")===0&&c.indexOf("transport=udp")!==-1&&c.indexOf("turn:[")===-1&&!r;return l?(r=!0,!0):c.indexOf("stun:")===0&&e>=14393&&c.indexOf("?transport=udp")===-1}),delete n.url,n.urls=a?i[0]:i,!!i.length}})}function He(t,e){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(a,c){a=parseInt(a,10);for(var l=0;l<c.length;l++)if(c[l].payloadType===a||c[l].preferredPayloadType===a)return c[l]},i=function(a,c,l,s){var o=n(a.parameters.apt,l),u=n(c.parameters.apt,s);return o&&u&&o.name.toLowerCase()===u.name.toLowerCase()};return t.codecs.forEach(function(a){for(var c=0;c<e.codecs.length;c++){var l=e.codecs[c];if(a.name.toLowerCase()===l.name.toLowerCase()&&a.clockRate===l.clockRate){if(a.name.toLowerCase()==="rtx"&&a.parameters&&l.parameters.apt&&!i(a,l,t.codecs,e.codecs))continue;l=JSON.parse(JSON.stringify(l)),l.numChannels=Math.min(a.numChannels,l.numChannels),r.codecs.push(l),l.rtcpFeedback=l.rtcpFeedback.filter(function(s){for(var o=0;o<a.rtcpFeedback.length;o++)if(a.rtcpFeedback[o].type===s.type&&a.rtcpFeedback[o].parameter===s.parameter)return!0;return!1});break}}}),t.headerExtensions.forEach(function(a){for(var c=0;c<e.headerExtensions.length;c++){var l=e.headerExtensions[c];if(a.uri===l.uri){r.headerExtensions.push(l);break}}}),r}function Ht(t,e,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][t].indexOf(r)!==-1}function ut(t,e){var r=t.getRemoteCandidates().find(function(n){return e.foundation===n.foundation&&e.ip===n.ip&&e.port===n.port&&e.priority===n.priority&&e.protocol===n.protocol&&e.type===n.type});return r||t.addRemoteCandidate(e),!r}function K(t,e){var r=new Error(e);return r.name=t,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[t],r}var Zr=function(t,e){function r(s,o){o.addTrack(s),o.dispatchEvent(new t.MediaStreamTrackEvent("addtrack",{track:s}))}function n(s,o){o.removeTrack(s),o.dispatchEvent(new t.MediaStreamTrackEvent("removetrack",{track:s}))}function i(s,o,u,f){var d=new Event("track");d.track=o,d.receiver=u,d.transceiver={receiver:u},d.streams=f,t.setTimeout(function(){s._dispatchEvent("track",d)})}var a=function(s){var o=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(d){o[d]=u[d].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",s=JSON.parse(JSON.stringify(s||{})),this.usingBundle=s.bundlePolicy==="max-bundle",s.rtcpMuxPolicy==="negotiate")throw K("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(s.rtcpMuxPolicy||(s.rtcpMuxPolicy="require"),s.iceTransportPolicy){case"all":case"relay":break;default:s.iceTransportPolicy="all";break}switch(s.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:s.bundlePolicy="balanced";break}if(s.iceServers=Yr(s.iceServers||[],e),this._iceGatherers=[],s.iceCandidatePoolSize)for(var f=s.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new t.RTCIceGatherer({iceServers:s.iceServers,gatherPolicy:s.iceTransportPolicy}));else s.iceCandidatePoolSize=0;this._config=s,this.transceivers=[],this._sdpSessionId=R.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(a.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(a.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),a.prototype.onicecandidate=null,a.prototype.onaddstream=null,a.prototype.ontrack=null,a.prototype.onremovestream=null,a.prototype.onsignalingstatechange=null,a.prototype.oniceconnectionstatechange=null,a.prototype.onconnectionstatechange=null,a.prototype.onicegatheringstatechange=null,a.prototype.onnegotiationneeded=null,a.prototype.ondatachannel=null,a.prototype._dispatchEvent=function(s,o){this._isClosed||(this.dispatchEvent(o),typeof this["on"+s]=="function"&&this["on"+s](o))},a.prototype._emitGatheringStateChange=function(){var s=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",s)},a.prototype.getConfiguration=function(){return this._config},a.prototype.getLocalStreams=function(){return this.localStreams},a.prototype.getRemoteStreams=function(){return this.remoteStreams},a.prototype._createTransceiver=function(s,o){var u=this.transceivers.length>0,f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:s,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport;else{var d=this._createIceAndDtlsTransports();f.iceTransport=d.iceTransport,f.dtlsTransport=d.dtlsTransport}return o||this.transceivers.push(f),f},a.prototype.addTrack=function(s,o){if(this._isClosed)throw K("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(m){return m.track===s});if(u)throw K("InvalidAccessError","Track already exists.");for(var f,d=0;d<this.transceivers.length;d++)!this.transceivers[d].track&&this.transceivers[d].kind===s.kind&&(f=this.transceivers[d]);return f||(f=this._createTransceiver(s.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(o)===-1&&this.localStreams.push(o),f.track=s,f.stream=o,f.rtpSender=new t.RTCRtpSender(s,f.dtlsTransport),f.rtpSender},a.prototype.addStream=function(s){var o=this;if(e>=15025)s.getTracks().forEach(function(f){o.addTrack(f,s)});else{var u=s.clone();s.getTracks().forEach(function(f,d){var m=u.getTracks()[d];f.addEventListener("enabled",function(h){m.enabled=h.enabled})}),u.getTracks().forEach(function(f){o.addTrack(f,u)})}},a.prototype.removeTrack=function(s){if(this._isClosed)throw K("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof t.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var o=this.transceivers.find(function(d){return d.rtpSender===s});if(!o)throw K("InvalidAccessError","Sender was not created by this connection.");var u=o.stream;o.rtpSender.stop(),o.rtpSender=null,o.track=null,o.stream=null;var f=this.transceivers.map(function(d){return d.stream});f.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},a.prototype.removeStream=function(s){var o=this;s.getTracks().forEach(function(u){var f=o.getSenders().find(function(d){return d.track===u});f&&o.removeTrack(f)})},a.prototype.getSenders=function(){return this.transceivers.filter(function(s){return!!s.rtpSender}).map(function(s){return s.rtpSender})},a.prototype.getReceivers=function(){return this.transceivers.filter(function(s){return!!s.rtpReceiver}).map(function(s){return s.rtpReceiver})},a.prototype._createIceGatherer=function(s,o){var u=this;if(o&&s>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new t.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[s].bufferedCandidateEvents=[],this.transceivers[s].bufferCandidates=function(d){var m=!d.candidate||Object.keys(d.candidate).length===0;f.state=m?"completed":"gathering",u.transceivers[s].bufferedCandidateEvents!==null&&u.transceivers[s].bufferedCandidateEvents.push(d)},f.addEventListener("localcandidate",this.transceivers[s].bufferCandidates),f},a.prototype._gather=function(s,o){var u=this,f=this.transceivers[o].iceGatherer;if(!f.onlocalcandidate){var d=this.transceivers[o].bufferedCandidateEvents;this.transceivers[o].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[o].bufferCandidates),f.onlocalcandidate=function(m){if(!(u.usingBundle&&o>0)){var h=new Event("icecandidate");h.candidate={sdpMid:s,sdpMLineIndex:o};var T=m.candidate,N=!T||Object.keys(T).length===0;if(N)(f.state==="new"||f.state==="gathering")&&(f.state="completed");else{f.state==="new"&&(f.state="gathering"),T.component=1,T.ufrag=f.getLocalParameters().usernameFragment;var y=R.writeCandidate(T);h.candidate=Object.assign(h.candidate,R.parseCandidate(y)),h.candidate.candidate=y,h.candidate.toJSON=function(){return{candidate:h.candidate.candidate,sdpMid:h.candidate.sdpMid,sdpMLineIndex:h.candidate.sdpMLineIndex,usernameFragment:h.candidate.usernameFragment}}}var S=R.getMediaSections(u._localDescription.sdp);N?S[h.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:S[h.candidate.sdpMLineIndex]+="a="+h.candidate.candidate+`\r
`,u._localDescription.sdp=R.getDescription(u._localDescription.sdp)+S.join("");var j=u.transceivers.every(function(F){return F.iceGatherer&&F.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),N||u._dispatchEvent("icecandidate",h),j&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},t.setTimeout(function(){d.forEach(function(m){f.onlocalcandidate(m)})},0)}},a.prototype._createIceAndDtlsTransports=function(){var s=this,o=new t.RTCIceTransport(null);o.onicestatechange=function(){s._updateIceConnectionState(),s._updateConnectionState()};var u=new t.RTCDtlsTransport(o);return u.ondtlsstatechange=function(){s._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),s._updateConnectionState()},{iceTransport:o,dtlsTransport:u}},a.prototype._disposeIceAndDtlsTransports=function(s){var o=this.transceivers[s].iceGatherer;o&&(delete o.onlocalcandidate,delete this.transceivers[s].iceGatherer);var u=this.transceivers[s].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[s].iceTransport);var f=this.transceivers[s].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[s].dtlsTransport)},a.prototype._transceive=function(s,o,u){var f=He(s.localCapabilities,s.remoteCapabilities);o&&s.rtpSender&&(f.encodings=s.sendEncodingParameters,f.rtcp={cname:R.localCName,compound:s.rtcpParameters.compound},s.recvEncodingParameters.length&&(f.rtcp.ssrc=s.recvEncodingParameters[0].ssrc),s.rtpSender.send(f)),u&&s.rtpReceiver&&f.codecs.length>0&&(s.kind==="video"&&s.recvEncodingParameters&&e<15019&&s.recvEncodingParameters.forEach(function(d){delete d.rtx}),s.recvEncodingParameters.length?f.encodings=s.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:s.rtcpParameters.compound},s.rtcpParameters.cname&&(f.rtcp.cname=s.rtcpParameters.cname),s.sendEncodingParameters.length&&(f.rtcp.ssrc=s.sendEncodingParameters[0].ssrc),s.rtpReceiver.receive(f))},a.prototype.setLocalDescription=function(s){var o=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(K("TypeError",'Unsupported type "'+s.type+'"'));if(!Ht("setLocalDescription",s.type,o.signalingState)||o._isClosed)return Promise.reject(K("InvalidStateError","Can not set local "+s.type+" in state "+o.signalingState));var u,f;if(s.type==="offer")u=R.splitSections(s.sdp),f=u.shift(),u.forEach(function(m,h){var T=R.parseRtpParameters(m);o.transceivers[h].localCapabilities=T}),o.transceivers.forEach(function(m,h){o._gather(m.mid,h)});else if(s.type==="answer"){u=R.splitSections(o._remoteDescription.sdp),f=u.shift();var d=R.matchPrefix(f,"a=ice-lite").length>0;u.forEach(function(m,h){var T=o.transceivers[h],N=T.iceGatherer,y=T.iceTransport,S=T.dtlsTransport,j=T.localCapabilities,F=T.remoteCapabilities,O=R.isRejected(m)&&R.matchPrefix(m,"a=bundle-only").length===0;if(!O&&!T.rejected){var z=R.getIceParameters(m,f),B=R.getDtlsParameters(m,f);d&&(B.role="server"),(!o.usingBundle||h===0)&&(o._gather(T.mid,h),y.state==="new"&&y.start(N,z,d?"controlling":"controlled"),S.state==="new"&&S.start(B));var q=He(j,F);o._transceive(T,q.codecs.length>0,!1)}})}return o._localDescription={type:s.type,sdp:s.sdp},s.type==="offer"?o._updateSignalingState("have-local-offer"):o._updateSignalingState("stable"),Promise.resolve()},a.prototype.setRemoteDescription=function(s){var o=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(K("TypeError",'Unsupported type "'+s.type+'"'));if(!Ht("setRemoteDescription",s.type,o.signalingState)||o._isClosed)return Promise.reject(K("InvalidStateError","Can not set remote "+s.type+" in state "+o.signalingState));var u={};o.remoteStreams.forEach(function(y){u[y.id]=y});var f=[],d=R.splitSections(s.sdp),m=d.shift(),h=R.matchPrefix(m,"a=ice-lite").length>0,T=R.matchPrefix(m,"a=group:BUNDLE ").length>0;o.usingBundle=T;var N=R.matchPrefix(m,"a=ice-options:")[0];return N?o.canTrickleIceCandidates=N.substr(14).split(" ").indexOf("trickle")>=0:o.canTrickleIceCandidates=!1,d.forEach(function(y,S){var j=R.splitLines(y),F=R.getKind(y),O=R.isRejected(y)&&R.matchPrefix(y,"a=bundle-only").length===0,z=j[0].substr(2).split(" ")[2],B=R.getDirection(y,m),q=R.parseMsid(y),me=R.getMid(y)||R.generateIdentifier();if(O||F==="application"&&(z==="DTLS/SCTP"||z==="UDP/DTLS/SCTP")){o.transceivers[S]={mid:me,kind:F,protocol:z,rejected:!0};return}!O&&o.transceivers[S]&&o.transceivers[S].rejected&&(o.transceivers[S]=o._createTransceiver(F,!0));var _,Ie,de,pe,X,ve,he,_e,le,tt=R.parseRtpParameters(y),rt,Be;O||(rt=R.getIceParameters(y,m),Be=R.getDtlsParameters(y,m),Be.role="client"),he=R.parseRtpEncodingParameters(y);var ze=R.parseRtcpParameters(y),Ce=R.matchPrefix(y,"a=end-of-candidates",m).length>0,ye=R.matchPrefix(y,"a=candidate:").map(function(J){return R.parseCandidate(J)}).filter(function(J){return J.component===1});if((s.type==="offer"||s.type==="answer")&&!O&&T&&S>0&&o.transceivers[S]&&(o._disposeIceAndDtlsTransports(S),o.transceivers[S].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[S].iceTransport=o.transceivers[0].iceTransport,o.transceivers[S].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[S].rtpSender&&o.transceivers[S].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[S].rtpReceiver&&o.transceivers[S].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),s.type==="offer"&&!O){_=o.transceivers[S]||o._createTransceiver(F),_.mid=me,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(S,T)),ye.length&&_.iceTransport.state==="new"&&(Ce&&(!T||S===0)?_.iceTransport.setRemoteCandidates(ye):ye.forEach(function(J){ut(_.iceTransport,J)})),_e=t.RTCRtpReceiver.getCapabilities(F),e<15019&&(_e.codecs=_e.codecs.filter(function(J){return J.name!=="rtx"})),ve=_.sendEncodingParameters||[{ssrc:(2*S+2)*1001}];var ie=!1;if(B==="sendrecv"||B==="sendonly"){if(ie=!_.rtpReceiver,X=_.rtpReceiver||new t.RTCRtpReceiver(_.dtlsTransport,F),ie){var G;le=X.track,q&&q.stream==="-"||(q?(u[q.stream]||(u[q.stream]=new t.MediaStream,Object.defineProperty(u[q.stream],"id",{get:function(){return q.stream}})),Object.defineProperty(le,"id",{get:function(){return q.track}}),G=u[q.stream]):(u.default||(u.default=new t.MediaStream),G=u.default)),G&&(r(le,G),_.associatedRemoteMediaStreams.push(G)),f.push([le,X,G])}}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(J){var nt=J.getTracks().find(function(it){return it.id===_.rtpReceiver.track.id});nt&&n(nt,J)}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=_e,_.remoteCapabilities=tt,_.rtpReceiver=X,_.rtcpParameters=ze,_.sendEncodingParameters=ve,_.recvEncodingParameters=he,o._transceive(o.transceivers[S],!1,ie)}else if(s.type==="answer"&&!O){_=o.transceivers[S],Ie=_.iceGatherer,de=_.iceTransport,pe=_.dtlsTransport,X=_.rtpReceiver,ve=_.sendEncodingParameters,_e=_.localCapabilities,o.transceivers[S].recvEncodingParameters=he,o.transceivers[S].remoteCapabilities=tt,o.transceivers[S].rtcpParameters=ze,ye.length&&de.state==="new"&&((h||Ce)&&(!T||S===0)?de.setRemoteCandidates(ye):ye.forEach(function(J){ut(_.iceTransport,J)})),(!T||S===0)&&(de.state==="new"&&de.start(Ie,rt,"controlling"),pe.state==="new"&&pe.start(Be));var Ve=He(_.localCapabilities,_.remoteCapabilities),We=Ve.codecs.filter(function(J){return J.name.toLowerCase()==="rtx"}).length;!We&&_.sendEncodingParameters[0].rtx&&delete _.sendEncodingParameters[0].rtx,o._transceive(_,B==="sendrecv"||B==="recvonly",B==="sendrecv"||B==="sendonly"),X&&(B==="sendrecv"||B==="sendonly")?(le=X.track,q?(u[q.stream]||(u[q.stream]=new t.MediaStream),r(le,u[q.stream]),f.push([le,X,u[q.stream]])):(u.default||(u.default=new t.MediaStream),r(le,u.default),f.push([le,X,u.default]))):delete _.rtpReceiver}}),o._dtlsRole===void 0&&(o._dtlsRole=s.type==="offer"?"active":"passive"),o._remoteDescription={type:s.type,sdp:s.sdp},s.type==="offer"?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(u).forEach(function(y){var S=u[y];if(S.getTracks().length){if(o.remoteStreams.indexOf(S)===-1){o.remoteStreams.push(S);var j=new Event("addstream");j.stream=S,t.setTimeout(function(){o._dispatchEvent("addstream",j)})}f.forEach(function(F){var O=F[0],z=F[1];S.id===F[2].id&&i(o,O,z,[S])})}}),f.forEach(function(y){y[2]||i(o,y[0],y[1],[])}),t.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.state==="new"&&y.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),y.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},a.prototype.close=function(){this.transceivers.forEach(function(s){s.iceTransport&&s.iceTransport.stop(),s.dtlsTransport&&s.dtlsTransport.stop(),s.rtpSender&&s.rtpSender.stop(),s.rtpReceiver&&s.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},a.prototype._updateSignalingState=function(s){this.signalingState=s;var o=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",o)},a.prototype._maybeFireNegotiationNeeded=function(){var s=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,t.setTimeout(function(){if(s.needNegotiation){s.needNegotiation=!1;var o=new Event("negotiationneeded");s._dispatchEvent("negotiationneeded",o)}},0))},a.prototype._updateIceConnectionState=function(){var s,o={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&!f.rejected&&o[f.iceTransport.state]++}),s="new",o.failed>0?s="failed":o.checking>0?s="checking":o.disconnected>0?s="disconnected":o.new>0?s="new":o.connected>0?s="connected":o.completed>0&&(s="completed"),s!==this.iceConnectionState){this.iceConnectionState=s;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},a.prototype._updateConnectionState=function(){var s,o={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&f.dtlsTransport&&!f.rejected&&(o[f.iceTransport.state]++,o[f.dtlsTransport.state]++)}),o.connected+=o.completed,s="new",o.failed>0?s="failed":o.connecting>0?s="connecting":o.disconnected>0?s="disconnected":o.new>0?s="new":o.connected>0&&(s="connected"),s!==this.connectionState){this.connectionState=s;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},a.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(K("InvalidStateError","Can not call createOffer after close"));var o=s.transceivers.filter(function(h){return h.kind==="audio"}).length,u=s.transceivers.filter(function(h){return h.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(f.offerToReceiveAudio===!0?o=1:f.offerToReceiveAudio===!1?o=0:o=f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(f.offerToReceiveVideo===!0?u=1:f.offerToReceiveVideo===!1?u=0:u=f.offerToReceiveVideo)}for(s.transceivers.forEach(function(h){h.kind==="audio"?(o--,o<0&&(h.wantReceive=!1)):h.kind==="video"&&(u--,u<0&&(h.wantReceive=!1))});o>0||u>0;)o>0&&(s._createTransceiver("audio"),o--),u>0&&(s._createTransceiver("video"),u--);var d=R.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(h,T){var N=h.track,y=h.kind,S=h.mid||R.generateIdentifier();h.mid=S,h.iceGatherer||(h.iceGatherer=s._createIceGatherer(T,s.usingBundle));var j=t.RTCRtpSender.getCapabilities(y);e<15019&&(j.codecs=j.codecs.filter(function(O){return O.name!=="rtx"})),j.codecs.forEach(function(O){O.name==="H264"&&O.parameters["level-asymmetry-allowed"]===void 0&&(O.parameters["level-asymmetry-allowed"]="1"),h.remoteCapabilities&&h.remoteCapabilities.codecs&&h.remoteCapabilities.codecs.forEach(function(z){O.name.toLowerCase()===z.name.toLowerCase()&&O.clockRate===z.clockRate&&(O.preferredPayloadType=z.payloadType)})}),j.headerExtensions.forEach(function(O){var z=h.remoteCapabilities&&h.remoteCapabilities.headerExtensions||[];z.forEach(function(B){O.uri===B.uri&&(O.id=B.id)})});var F=h.sendEncodingParameters||[{ssrc:(2*T+1)*1001}];N&&e>=15019&&y==="video"&&!F[0].rtx&&(F[0].rtx={ssrc:F[0].ssrc+1}),h.wantReceive&&(h.rtpReceiver=new t.RTCRtpReceiver(h.dtlsTransport,y)),h.localCapabilities=j,h.sendEncodingParameters=F}),s._config.bundlePolicy!=="max-compat"&&(d+="a=group:BUNDLE "+s.transceivers.map(function(h){return h.mid}).join(" ")+`\r
`),d+=`a=ice-options:trickle\r
`,s.transceivers.forEach(function(h,T){d+=qt(h,h.localCapabilities,"offer",h.stream,s._dtlsRole),d+=`a=rtcp-rsize\r
`,h.iceGatherer&&s.iceGatheringState!=="new"&&(T===0||!s.usingBundle)&&(h.iceGatherer.getLocalCandidates().forEach(function(N){N.component=1,d+="a="+R.writeCandidate(N)+`\r
`}),h.iceGatherer.state==="completed"&&(d+=`a=end-of-candidates\r
`))});var m=new t.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(m)},a.prototype.createAnswer=function(){var s=this;if(s._isClosed)return Promise.reject(K("InvalidStateError","Can not call createAnswer after close"));if(!(s.signalingState==="have-remote-offer"||s.signalingState==="have-local-pranswer"))return Promise.reject(K("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState));var o=R.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.usingBundle&&(o+="a=group:BUNDLE "+s.transceivers.map(function(d){return d.mid}).join(" ")+`\r
`),o+=`a=ice-options:trickle\r
`;var u=R.getMediaSections(s._remoteDescription.sdp).length;s.transceivers.forEach(function(d,m){if(!(m+1>u)){if(d.rejected){d.kind==="application"?d.protocol==="DTLS/SCTP"?o+=`m=application 0 DTLS/SCTP 5000\r
`:o+="m=application 0 "+d.protocol+` webrtc-datachannel\r
`:d.kind==="audio"?o+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:d.kind==="video"&&(o+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),o+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+d.mid+`\r
`;return}if(d.stream){var h;d.kind==="audio"?h=d.stream.getAudioTracks()[0]:d.kind==="video"&&(h=d.stream.getVideoTracks()[0]),h&&e>=15019&&d.kind==="video"&&!d.sendEncodingParameters[0].rtx&&(d.sendEncodingParameters[0].rtx={ssrc:d.sendEncodingParameters[0].ssrc+1})}var T=He(d.localCapabilities,d.remoteCapabilities),N=T.codecs.filter(function(y){return y.name.toLowerCase()==="rtx"}).length;!N&&d.sendEncodingParameters[0].rtx&&delete d.sendEncodingParameters[0].rtx,o+=qt(d,T,"answer",d.stream,s._dtlsRole),d.rtcpParameters&&d.rtcpParameters.reducedSize&&(o+=`a=rtcp-rsize\r
`)}});var f=new t.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(f)},a.prototype.addIceCandidate=function(s){var o=this,u;return s&&!(s.sdpMLineIndex!==void 0||s.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,d){if(o._remoteDescription)if(!s||s.candidate==="")for(var m=0;m<o.transceivers.length&&!(!o.transceivers[m].rejected&&(o.transceivers[m].iceTransport.addRemoteCandidate({}),u=R.getMediaSections(o._remoteDescription.sdp),u[m]+=`a=end-of-candidates\r
`,o._remoteDescription.sdp=R.getDescription(o._remoteDescription.sdp)+u.join(""),o.usingBundle));m++);else{var h=s.sdpMLineIndex;if(s.sdpMid){for(var T=0;T<o.transceivers.length;T++)if(o.transceivers[T].mid===s.sdpMid){h=T;break}}var N=o.transceivers[h];if(N){if(N.rejected)return f();var y=Object.keys(s.candidate).length>0?R.parseCandidate(s.candidate):{};if(y.protocol==="tcp"&&(y.port===0||y.port===9)||y.component&&y.component!==1)return f();if((h===0||h>0&&N.iceTransport!==o.transceivers[0].iceTransport)&&!ut(N.iceTransport,y))return d(K("OperationError","Can not add ICE candidate"));var S=s.candidate.trim();S.indexOf("a=")===0&&(S=S.substr(2)),u=R.getMediaSections(o._remoteDescription.sdp),u[h]+="a="+(y.type?S:"end-of-candidates")+`\r
`,o._remoteDescription.sdp=R.getDescription(o._remoteDescription.sdp)+u.join("")}else return d(K("OperationError","Can not add ICE candidate"))}else return d(K("InvalidStateError","Can not add ICE candidate without a remote description"));f()})},a.prototype.getStats=function(s){if(s&&s instanceof t.MediaStreamTrack){var o=null;if(this.transceivers.forEach(function(f){f.rtpSender&&f.rtpSender.track===s?o=f.rtpSender:f.rtpReceiver&&f.rtpReceiver.track===s&&(o=f.rtpReceiver)}),!o)throw K("InvalidAccessError","Invalid selector.");return o.getStats()}var u=[];return this.transceivers.forEach(function(f){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(d){f[d]&&u.push(f[d].getStats())})}),Promise.all(u).then(function(f){var d=new Map;return f.forEach(function(m){m.forEach(function(h){d.set(h.id,h)})}),d})};var c=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];c.forEach(function(s){var o=t[s];if(o&&o.prototype&&o.prototype.getStats){var u=o.prototype.getStats;o.prototype.getStats=function(){return u.apply(this).then(function(f){var d=new Map;return Object.keys(f).forEach(function(m){f[m].type=Qr(f[m]),d.set(m,f[m])}),d})}}});var l=["createOffer","createAnswer"];return l.forEach(function(s){var o=a.prototype[s];a.prototype[s]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?o.apply(this,[arguments[2]]).then(function(f){typeof u[0]=="function"&&u[0].apply(null,[f])},function(f){typeof u[1]=="function"&&u[1].apply(null,[f])}):o.apply(this,arguments)}}),l=["setLocalDescription","setRemoteDescription","addIceCandidate"],l.forEach(function(s){var o=a.prototype[s];a.prototype[s]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?o.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(f){typeof u[2]=="function"&&u[2].apply(null,[f])}):o.apply(this,arguments)}}),["getStats"].forEach(function(s){var o=a.prototype[s];a.prototype[s]=function(){var u=arguments;return typeof u[1]=="function"?o.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):o.apply(this,arguments)}}),a};function Jt(t){const e=t&&t.navigator,r=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},n=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(i){return n(i).catch(a=>Promise.reject(r(a)))}}function $t(t){"getDisplayMedia"in t.navigator&&t.navigator.mediaDevices&&(t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||(t.navigator.mediaDevices.getDisplayMedia=t.navigator.getDisplayMedia.bind(t.navigator)))}function lt(t,e){if(t.RTCIceGatherer&&(t.RTCIceCandidate||(t.RTCIceCandidate=function(i){return i}),t.RTCSessionDescription||(t.RTCSessionDescription=function(i){return i}),e.version<15025)){const n=Object.getOwnPropertyDescriptor(t.MediaStreamTrack.prototype,"enabled");Object.defineProperty(t.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const a=new Event("enabled");a.enabled=i,this.dispatchEvent(a)}})}t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)&&Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new t.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),t.RTCDtmfSender&&!t.RTCDTMFSender&&(t.RTCDTMFSender=t.RTCDtmfSender);const r=Zr(t,e.version);t.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=Kr(i.iceServers,e.version),Pe("ICE servers after filtering:",i.iceServers)),new r(i)},t.RTCPeerConnection.prototype=r.prototype}function Kt(t){t.RTCRtpSender&&!("replaceTrack"in t.RTCRtpSender.prototype)&&(t.RTCRtpSender.prototype.replaceTrack=t.RTCRtpSender.prototype.setTrack)}var Xt=Object.freeze({__proto__:null,shimPeerConnection:lt,shimReplaceTrack:Kt,shimGetUserMedia:Jt,shimGetDisplayMedia:$t});function Qt(t,e){const r=t&&t.navigator,n=t&&t.MediaStreamTrack;if(r.getUserMedia=function(i,a,c){ne("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(a,c)},!(e.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const i=function(c,l,s){l in c&&!(s in c)&&(c[s]=c[l],delete c[l])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},n&&n.prototype.getSettings){const c=n.prototype.getSettings;n.prototype.getSettings=function(){const l=c.apply(this,arguments);return i(l,"mozAutoGainControl","autoGainControl"),i(l,"mozNoiseSuppression","noiseSuppression"),l}}if(n&&n.prototype.applyConstraints){const c=n.prototype.applyConstraints;n.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l,"autoGainControl","mozAutoGainControl"),i(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function wr(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})}function Yt(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ft(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const a=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]});const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[a,c,l]=arguments;return n.apply(this,[a||null]).then(s=>{if(e.version<53&&!c)try{s.forEach(o=>{o.type=r[o.type]||o.type})}catch(o){if(o.name!=="TypeError")throw o;s.forEach((u,f)=>{s.set(f,Object.assign({},u,{type:r[u.type]||u.type}))})}return s}).then(c,l)}}function Zt(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function wt(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),w(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function er(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){ne("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&r.getTracks().includes(n.track)&&this.removeTrack(n)})})}function tr(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function rr(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const a=e.apply(this,arguments);if(i){const{sender:c}=a,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=n.sendEncodings,c.sendEncodings=n.sendEncodings,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return a})}function nr(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function ir(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function ar(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var sr=Object.freeze({__proto__:null,shimOnTrack:Yt,shimPeerConnection:ft,shimSenderGetStats:Zt,shimReceiverGetStats:wt,shimRemoveStream:er,shimRTCDataChannel:tr,shimAddTransceiver:rr,shimGetParameters:nr,shimCreateOffer:ir,shimCreateAnswer:ar,shimGetUserMedia:Qt,shimGetDisplayMedia:wr});function or(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>e.call(this,i,n)),n.getVideoTracks().forEach(i=>e.call(this,i,n))},t.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(r);if(n===-1)return;this._localStreams.splice(n,1);const i=r.getTracks();this.getSenders().forEach(a=>{i.includes(a.track)&&this.removeTrack(a)})})}}function cr(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const a=new Event("addstream");a.stream=i,this.dispatchEvent(a)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(a=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(a)>=0)return;n._remoteStreams.push(a);const c=new Event("addstream");c.stream=a,n.dispatchEvent(c)})}),e.apply(n,arguments)}}}function ur(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,r=e.createOffer,n=e.createAnswer,i=e.setLocalDescription,a=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(o,u){const f=arguments.length>=2?arguments[2]:arguments[0],d=r.apply(this,[f]);return u?(d.then(o,u),Promise.resolve()):d},e.createAnswer=function(o,u){const f=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[f]);return u?(d.then(o,u),Promise.resolve()):d};let l=function(s,o,u){const f=i.apply(this,[s]);return u?(f.then(o,u),Promise.resolve()):f};e.setLocalDescription=l,l=function(s,o,u){const f=a.apply(this,[s]);return u?(f.then(o,u),Promise.resolve()):f},e.setRemoteDescription=l,l=function(s,o,u){const f=c.apply(this,[s]);return u?(f.then(o,u),Promise.resolve()):f},e.addIceCandidate=l}function lr(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const r=e.mediaDevices,n=r.getUserMedia.bind(r);e.mediaDevices.getUserMedia=i=>n(fr(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,a){e.mediaDevices.getUserMedia(n).then(i,a)}).bind(e))}function fr(t){return t&&t.video!==void 0?Object.assign({},t,{video:Dt(t.video)}):t}function dr(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const a=[];for(let c=0;c<n.iceServers.length;c++){let l=n.iceServers[c];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(ne("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,a.push(l)):a.push(n.iceServers[c])}n.iceServers=a}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function pr(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function hr(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const a=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):n.offerToReceiveVideo===!0&&!a&&this.addTransceiver("video")}return e.apply(this,arguments)}}function mr(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var vr=Object.freeze({__proto__:null,shimLocalStreamsAPI:or,shimRemoteStreamsAPI:cr,shimCallbacksAPI:ur,shimGetUserMedia:lr,shimConstraints:fr,shimRTCIceServerUrls:dr,shimTrackEventTransceiver:pr,shimCreateOfferLegacy:hr,shimAudioContext:mr});function Je(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),a=R.parseCandidate(n.candidate),c=Object.assign(i,a);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,w(t,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new t.RTCIceCandidate(r.candidate),writable:"false"}),r))}function Fe(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const r=function(l){if(!l||!l.sdp)return!1;const s=R.splitSections(l.sdp);return s.shift(),s.some(o=>{const u=R.parseMLine(o);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},n=function(l){const s=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;const o=parseInt(s[1],10);return o!==o?-1:o},i=function(l){let s=65536;return e.browser==="firefox"&&(e.version<57?l===-1?s=16384:s=2147483637:e.version<60?s=e.version===57?65535:65536:s=2147483637),s},a=function(l,s){let o=65536;e.browser==="firefox"&&e.version===57&&(o=65535);const u=R.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?o=parseInt(u[0].substr(19),10):e.browser==="firefox"&&s!==-1&&(o=2147483637),o},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const s=n(arguments[0]),o=i(s),u=a(arguments[0],s);let f;o===0&&u===0?f=Number.POSITIVE_INFINITY:o===0||u===0?f=Math.max(o,u):f=Math.min(o,u);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return f}}),this._sctp=d}return c.apply(this,arguments)}}function Ge(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(n,i){const a=n.send;n.send=function(){const l=arguments[0],s=l.length||l.size||l.byteLength;if(n.readyState==="open"&&i.sctp&&s>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return a.apply(n,arguments)}}const r=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=r.apply(this,arguments);return e(i,this),i},w(t,"datachannel",n=>(e(n.channel,n.target),n))}function dt(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{const n=e[r];e[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const a=i.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",i);a.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function pt(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const a=i.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:a}):i.sdp=a}return r.apply(this,arguments)}}function $e(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const r=t.RTCPeerConnection.prototype.addIceCandidate;!r||r.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var en=Object.freeze({__proto__:null,shimRTCIceCandidate:Je,shimMaxMessageSize:Fe,shimSendThrowTypeError:Ge,shimConnectionState:dt,removeExtmapAllowMixed:pt,shimAddIceCandidateNullOrEmpty:$e});function tn({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const r=Pe,n=k(t),i={browserDetails:n,commonShim:en,extractVersion:re,disableLog:Y,disableWarnings:L};switch(n.browser){case"chrome":if(!Vt||!ot||!e.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=Vt,$e(t,n),Nt(t,n),It(t),ot(t,n),Lt(t),Bt(t,n),jt(t),Ft(t),Gt(t),zt(t,n),Je(t),dt(t),Fe(t,n),Ge(t),pt(t,n);break;case"firefox":if(!sr||!ft||!e.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=sr,$e(t,n),Qt(t,n),ft(t,n),Yt(t),er(t),Zt(t),wt(t),tr(t),rr(t),nr(t),ir(t),ar(t),Je(t),dt(t),Fe(t,n),Ge(t);break;case"edge":if(!Xt||!lt||!e.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),i.browserShim=Xt,Jt(t),$t(t),lt(t,n),Kt(t),Fe(t,n),Ge(t);break;case"safari":if(!vr||!e.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=vr,$e(t,n),dr(t),hr(t),ur(t),or(t),cr(t),pr(t),lr(t),mr(t),Je(t),Fe(t,n),Ge(t),pt(t,n);break;default:r("Unsupported browser!");break}return i}tn({window:typeof window>"u"?void 0:window});class Ae{constructor(e){if(!Object.values(x).some(r=>r===e))throw new TypeError("Invalid source.");this.source=e,this.deviceId=void 0}}class Se{constructor(e){if(!Object.values(U).some(r=>r===e))throw new TypeError("Invalid source.");this.source=e,this.deviceId=void 0,this.resolution=void 0,this.frameRate=void 0}}class ke{constructor(e=!1,r=!1){this.audio=e,this.video=r}}function Ke(t){return typeof t.video=="object"&&t.video.source===U.SCREENCAST}class Oe{static createMediaStream(e){if(typeof e!="object"||!e.audio&&!e.video)return Promise.reject(new TypeError("Invalid constrains"));if(!Ke(e)&&typeof e.audio=="object"&&e.audio.source===x.SCREENCAST)return Promise.reject(new TypeError("Cannot share screen without video."));if(Ke(e)&&!P()&&!ae())return Promise.reject(new TypeError("Screen sharing only supports Chrome and Firefox."));if(Ke(e)&&typeof e.audio=="object"&&e.audio.source!==x.SCREENCAST)return Promise.reject(new TypeError("Cannot capture video from screen cast while capture audio from other source."));if(!e.audio&&!e.video)return Promise.reject(new TypeError("At least one of audio and video must be requested."));const r=Object.create({});return typeof e.audio=="object"&&e.audio.source===x.MIC?(r.audio=Object.create({}),Z()?r.audio.deviceId=e.audio.deviceId:r.audio.deviceId={exact:e.audio.deviceId}):e.audio.source===x.SCREENCAST?r.audio=!0:r.audio=e.audio,typeof e.video=="object"?(r.video=Object.create({}),typeof e.video.frameRate=="number"&&(r.video.frameRate=e.video.frameRate),e.video.resolution&&e.video.resolution.width&&e.video.resolution.height&&(e.video.source===U.SCREENCAST?(r.video.width=e.video.resolution.width,r.video.height=e.video.resolution.height):(r.video.width=Object.create({}),r.video.width.exact=e.video.resolution.width,r.video.height=Object.create({}),r.video.height.exact=e.video.resolution.height)),typeof e.video.deviceId=="string"&&(r.video.deviceId={exact:e.video.deviceId}),ae()&&e.video.source===U.SCREENCAST&&(r.video.mediaSource="screen")):r.video=e.video,Ke(e)?navigator.mediaDevices.getDisplayMedia(r):navigator.mediaDevices.getUserMedia(r)}}var rn=Object.freeze({__proto__:null,AudioTrackConstraints:Ae,VideoTrackConstraints:Se,StreamConstraints:ke,MediaStreamFactory:Oe,AudioSourceInfo:x,VideoSourceInfo:U,TrackKind:ue,Resolution:se});let ht,mt;function nn(){ht=console.log,mt=console.error}function ce(t,...e){ht&&ht(t,...e)}function ge(t,...e){mt&&mt(t,...e)}class an{constructor(e){this.listener={},this.type=e|""}on(e,r){return this.listener[e]||(this.listener[e]=[]),this.listener[e].push(r),!0}off(e,r){if(this.listener[e]){var n=this.listener[e].indexOf(r);return n>-1&&this.listener[e].splice(n,1),!0}return!1}offAll(){this.listener={}}dispatch(e,r){return this.listener[e]?(this.listener[e].map(n=>{n.apply(null,[r])}),!0):!1}}var gr=function(e,r){return function(){for(var i=new Array(arguments.length),a=0;a<i.length;a++)i[a]=arguments[a];return e.apply(r,i)}},vt=Object.prototype.toString,gt=function(t){return function(e){var r=vt.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function Ee(t){return t=t.toLowerCase(),function(r){return gt(r)===t}}function Ct(t){return Array.isArray(t)}function Xe(t){return typeof t>"u"}function sn(t){return t!==null&&!Xe(t)&&t.constructor!==null&&!Xe(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var Cr=Ee("ArrayBuffer");function on(t){var e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Cr(t.buffer),e}function cn(t){return typeof t=="string"}function un(t){return typeof t=="number"}function yr(t){return t!==null&&typeof t=="object"}function Qe(t){if(gt(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var ln=Ee("Date"),fn=Ee("File"),dn=Ee("Blob"),pn=Ee("FileList");function yt(t){return vt.call(t)==="[object Function]"}function hn(t){return yr(t)&&yt(t.pipe)}function mn(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||vt.call(t)===e||yt(t.toString)&&t.toString()===e)}var vn=Ee("URLSearchParams");function gn(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Cn(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function Tt(t,e){if(!(t===null||typeof t>"u"))if(typeof t!="object"&&(t=[t]),Ct(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function St(){var t={};function e(i,a){Qe(t[a])&&Qe(i)?t[a]=St(t[a],i):Qe(i)?t[a]=St({},i):Ct(i)?t[a]=i.slice():t[a]=i}for(var r=0,n=arguments.length;r<n;r++)Tt(arguments[r],e);return t}function yn(t,e,r){return Tt(e,function(i,a){r&&typeof i=="function"?t[a]=gr(i,r):t[a]=i}),t}function Tn(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function Sn(t,e,r,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,r&&Object.assign(t.prototype,r)}function En(t,e,r){var n,i,a,c={};e=e||{};do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)a=n[i],c[a]||(e[a]=t[a],c[a]=!0);t=Object.getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e}function Rn(t,e,r){t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;var n=t.indexOf(e,r);return n!==-1&&n===r}function _n(t){if(!t)return null;var e=t.length;if(Xe(e))return null;for(var r=new Array(e);e-- >0;)r[e]=t[e];return r}var Pn=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array)),C={isArray:Ct,isArrayBuffer:Cr,isBuffer:sn,isFormData:mn,isArrayBufferView:on,isString:cn,isNumber:un,isObject:yr,isPlainObject:Qe,isUndefined:Xe,isDate:ln,isFile:fn,isBlob:dn,isFunction:yt,isStream:hn,isURLSearchParams:vn,isStandardBrowserEnv:Cn,forEach:Tt,merge:St,extend:yn,trim:gn,stripBOM:Tn,inherits:Sn,toFlatObject:En,kindOf:gt,kindOfTest:Ee,endsWith:Rn,toArray:_n,isTypedArray:Pn,isFileList:pn};function Tr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Sr=function(e,r,n){if(!r)return e;var i;if(n)i=n(r);else if(C.isURLSearchParams(r))i=r.toString();else{var a=[];C.forEach(r,function(s,o){s===null||typeof s>"u"||(C.isArray(s)?o=o+"[]":s=[s],C.forEach(s,function(f){C.isDate(f)?f=f.toISOString():C.isObject(f)&&(f=JSON.stringify(f)),a.push(Tr(o)+"="+Tr(f))}))}),i=a.join("&")}if(i){var c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e};function Ye(){this.handlers=[]}Ye.prototype.use=function(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1},Ye.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Ye.prototype.forEach=function(e){C.forEach(this.handlers,function(n){n!==null&&e(n)})};var Er=Ye,Rr=function(e,r){C.forEach(e,function(i,a){a!==r&&a.toUpperCase()===r.toUpperCase()&&(e[r]=i,delete e[a])})};function De(t,e,r,n,i){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}C.inherits(De,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var _r=De.prototype,Pr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){Pr[t]={value:t}}),Object.defineProperties(De,Pr),Object.defineProperty(_r,"isAxiosError",{value:!0}),De.from=function(t,e,r,n,i,a){var c=Object.create(_r);return C.toFlatObject(t,c,function(s){return s!==Error.prototype}),De.call(c,t.message,e,r,n,i),c.name=t.name,a&&Object.assign(c,a),c};var M=De,br={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function bn(t,e){e=e||new FormData;var r=[];function n(a){return a===null?"":C.isDate(a)?a.toISOString():C.isArrayBuffer(a)||C.isTypedArray(a)?typeof Blob=="function"?new Blob([a]):Buffer.from(a):a}function i(a,c){if(C.isPlainObject(a)||C.isArray(a)){if(r.indexOf(a)!==-1)throw Error("Circular reference detected in "+c);r.push(a),C.forEach(a,function(s,o){if(!C.isUndefined(s)){var u=c?c+"."+o:o,f;if(s&&!c&&typeof s=="object"){if(C.endsWith(o,"{}"))s=JSON.stringify(s);else if(C.endsWith(o,"[]")&&(f=C.toArray(s))){f.forEach(function(d){!C.isUndefined(d)&&e.append(u,n(d))});return}}i(s,u)}}),r.pop()}else e.append(c,n(a))}return i(t),e}var Ar=bn,An=function(e,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):r(new M("Request failed with status code "+n.status,[M.ERR_BAD_REQUEST,M.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))},kn=C.isStandardBrowserEnv()?function(){return{write:function(r,n,i,a,c,l){var s=[];s.push(r+"="+encodeURIComponent(n)),C.isNumber(i)&&s.push("expires="+new Date(i).toGMTString()),C.isString(a)&&s.push("path="+a),C.isString(c)&&s.push("domain="+c),l===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),On=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Dn=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e},kr=function(e,r){return e&&!On(r)?Dn(e,r):r},xn=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Mn=function(e){var r={},n,i,a;return e&&C.forEach(e.split(`
`),function(l){if(a=l.indexOf(":"),n=C.trim(l.substr(0,a)).toLowerCase(),i=C.trim(l.substr(a+1)),n){if(r[n]&&xn.indexOf(n)>=0)return;n==="set-cookie"?r[n]=(r[n]?r[n]:[]).concat([i]):r[n]=r[n]?r[n]+", "+i:i}}),r},Nn=C.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(a){var c=a;return e&&(r.setAttribute("href",c),c=r.href),r.setAttribute("href",c),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(c){var l=C.isString(c)?i(c):c;return l.protocol===n.protocol&&l.host===n.host}}():function(){return function(){return!0}}();function Or(t){M.call(this,t??"canceled",M.ERR_CANCELED),this.name="CanceledError"}C.inherits(Or,M,{__CANCEL__:!0});var Ze=Or,In=function(e){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""},Dr=function(e){return new Promise(function(n,i){var a=e.data,c=e.headers,l=e.responseType,s;function o(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}C.isFormData(a)&&C.isStandardBrowserEnv()&&delete c["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";c.Authorization="Basic "+btoa(f+":"+d)}var m=kr(e.baseURL,e.url);u.open(e.method.toUpperCase(),Sr(m,e.params,e.paramsSerializer),!0),u.timeout=e.timeout;function h(){if(u){var y="getAllResponseHeaders"in u?Mn(u.getAllResponseHeaders()):null,S=!l||l==="text"||l==="json"?u.responseText:u.response,j={data:S,status:u.status,statusText:u.statusText,headers:y,config:e,request:u};An(function(O){n(O),o()},function(O){i(O),o()},j),u=null}}if("onloadend"in u?u.onloadend=h:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(h)},u.onabort=function(){u&&(i(new M("Request aborted",M.ECONNABORTED,e,u)),u=null)},u.onerror=function(){i(new M("Network Error",M.ERR_NETWORK,e,u,u)),u=null},u.ontimeout=function(){var S=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",j=e.transitional||br;e.timeoutErrorMessage&&(S=e.timeoutErrorMessage),i(new M(S,j.clarifyTimeoutError?M.ETIMEDOUT:M.ECONNABORTED,e,u)),u=null},C.isStandardBrowserEnv()){var T=(e.withCredentials||Nn(m))&&e.xsrfCookieName?kn.read(e.xsrfCookieName):void 0;T&&(c[e.xsrfHeaderName]=T)}"setRequestHeader"in u&&C.forEach(c,function(S,j){typeof a>"u"&&j.toLowerCase()==="content-type"?delete c[j]:u.setRequestHeader(j,S)}),C.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),l&&l!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(s=function(y){u&&(i(!y||y&&y.type?new Ze:y),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s))),a||(a=null);var N=In(m);if(N&&["http","https","file"].indexOf(N)===-1){i(new M("Unsupported protocol "+N+":",M.ERR_BAD_REQUEST,e));return}u.send(a)})},Ln=null,jn={"Content-Type":"application/x-www-form-urlencoded"};function xr(t,e){!C.isUndefined(t)&&C.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function Fn(){var t;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(t=Dr),t}function Gn(t,e,r){if(C.isString(t))try{return(e||JSON.parse)(t),C.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var we={transitional:br,adapter:Fn(),transformRequest:[function(e,r){if(Rr(r,"Accept"),Rr(r,"Content-Type"),C.isFormData(e)||C.isArrayBuffer(e)||C.isBuffer(e)||C.isStream(e)||C.isFile(e)||C.isBlob(e))return e;if(C.isArrayBufferView(e))return e.buffer;if(C.isURLSearchParams(e))return xr(r,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n=C.isObject(e),i=r&&r["Content-Type"],a;if((a=C.isFileList(e))||n&&i==="multipart/form-data"){var c=this.env&&this.env.FormData;return Ar(a?{"files[]":e}:e,c&&new c)}else if(n||i==="application/json")return xr(r,"application/json"),Gn(e);return e}],transformResponse:[function(e){var r=this.transitional||we.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,a=!n&&this.responseType==="json";if(a||i&&C.isString(e)&&e.length)try{return JSON.parse(e)}catch(c){if(a)throw c.name==="SyntaxError"?M.from(c,M.ERR_BAD_RESPONSE,this,null,this.response):c}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ln},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};C.forEach(["delete","get","head"],function(e){we.headers[e]={}}),C.forEach(["post","put","patch"],function(e){we.headers[e]=C.merge(jn)});var Et=we,Rt=function(e,r,n){var i=this||Et;return C.forEach(n,function(c){e=c.call(i,e,r)}),e},Mr=function(e){return!!(e&&e.__CANCEL__)};function _t(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ze}var Nr=function(e){_t(e),e.headers=e.headers||{},e.data=Rt.call(e,e.data,e.headers,e.transformRequest),e.headers=C.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),C.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var r=e.adapter||Et.adapter;return r(e).then(function(i){return _t(e),i.data=Rt.call(e,i.data,i.headers,e.transformResponse),i},function(i){return Mr(i)||(_t(e),i&&i.response&&(i.response.data=Rt.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},Ue=function(e,r){r=r||{};var n={};function i(u,f){return C.isPlainObject(u)&&C.isPlainObject(f)?C.merge(u,f):C.isPlainObject(f)?C.merge({},f):C.isArray(f)?f.slice():f}function a(u){if(C.isUndefined(r[u])){if(!C.isUndefined(e[u]))return i(void 0,e[u])}else return i(e[u],r[u])}function c(u){if(!C.isUndefined(r[u]))return i(void 0,r[u])}function l(u){if(C.isUndefined(r[u])){if(!C.isUndefined(e[u]))return i(void 0,e[u])}else return i(void 0,r[u])}function s(u){if(u in r)return i(e[u],r[u]);if(u in e)return i(void 0,e[u])}var o={url:c,method:c,data:c,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:s};return C.forEach(Object.keys(e).concat(Object.keys(r)),function(f){var d=o[f]||a,m=d(f);C.isUndefined(m)&&d!==s||(n[f]=m)}),n},Ir={version:"0.27.2"},Un=Ir.version,Pt={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){Pt[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var Lr={};Pt.transitional=function(e,r,n){function i(a,c){return"[Axios v"+Un+"] Transitional option '"+a+"'"+c+(n?". "+n:"")}return function(a,c,l){if(e===!1)throw new M(i(c," has been removed"+(r?" in "+r:"")),M.ERR_DEPRECATED);return r&&!Lr[c]&&(Lr[c]=!0,console.warn(i(c," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(a,c,l):!0}};function Bn(t,e,r){if(typeof t!="object")throw new M("options must be an object",M.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),i=n.length;i-- >0;){var a=n[i],c=e[a];if(c){var l=t[a],s=l===void 0||c(l,a,t);if(s!==!0)throw new M("option "+a+" must be "+s,M.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new M("Unknown option "+a,M.ERR_BAD_OPTION)}}var jr={assertOptions:Bn,validators:Pt},xe=jr.validators;function Me(t){this.defaults=t,this.interceptors={request:new Er,response:new Er}}Me.prototype.request=function(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=Ue(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&jr.assertOptions(n,{silentJSONParsing:xe.transitional(xe.boolean),forcedJSONParsing:xe.transitional(xe.boolean),clarifyTimeoutError:xe.transitional(xe.boolean)},!1);var i=[],a=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(r)===!1||(a=a&&m.synchronous,i.unshift(m.fulfilled,m.rejected))});var c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});var l;if(!a){var s=[Nr,void 0];for(Array.prototype.unshift.apply(s,i),s=s.concat(c),l=Promise.resolve(r);s.length;)l=l.then(s.shift(),s.shift());return l}for(var o=r;i.length;){var u=i.shift(),f=i.shift();try{o=u(o)}catch(d){f(d);break}}try{l=Nr(o)}catch(d){return Promise.reject(d)}for(;c.length;)l=l.then(c.shift(),c.shift());return l},Me.prototype.getUri=function(e){e=Ue(this.defaults,e);var r=kr(e.baseURL,e.url);return Sr(r,e.params,e.paramsSerializer)},C.forEach(["delete","get","head","options"],function(e){Me.prototype[e]=function(r,n){return this.request(Ue(n||{},{method:e,url:r,data:(n||{}).data}))}}),C.forEach(["post","put","patch"],function(e){function r(n){return function(a,c,l){return this.request(Ue(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}Me.prototype[e]=r(),Me.prototype[e+"Form"]=r(!0)});var et=Me;function Ne(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(i){e=i});var r=this;this.promise.then(function(n){if(r._listeners){var i,a=r._listeners.length;for(i=0;i<a;i++)r._listeners[i](n);r._listeners=null}}),this.promise.then=function(n){var i,a=new Promise(function(c){r.subscribe(c),i=c}).then(n);return a.cancel=function(){r.unsubscribe(i)},a},t(function(i){r.reason||(r.reason=new Ze(i),e(r.reason))})}Ne.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Ne.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]},Ne.prototype.unsubscribe=function(e){if(this._listeners){var r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}},Ne.source=function(){var e,r=new Ne(function(i){e=i});return{token:r,cancel:e}};var zn=Ne,Vn=function(e){return function(n){return e.apply(null,n)}},Wn=function(e){return C.isObject(e)&&e.isAxiosError===!0};function Fr(t){var e=new et(t),r=gr(et.prototype.request,e);return C.extend(r,et.prototype,e),C.extend(r,e),r.create=function(i){return Fr(Ue(t,i))},r}var ee=Fr(Et);ee.Axios=et,ee.CanceledError=Ze,ee.CancelToken=zn,ee.isCancel=Mr,ee.VERSION=Ir.version,ee.toFormData=Ar,ee.AxiosError=M,ee.Cancel=ee.CanceledError,ee.all=function(e){return Promise.all(e)},ee.spread=Vn,ee.isAxiosError=Wn;var Gr=ee,qn=ee;Gr.default=qn;var Ur=Gr;/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var Br=Wt(function(t,e){(function(r,n){t.exports=n()})(ct,function(){function r(p){var v=typeof p;return p!==null&&(v==="object"||v==="function")}function n(p){return typeof p=="function"}var i=void 0;Array.isArray?i=Array.isArray:i=function(p){return Object.prototype.toString.call(p)==="[object Array]"};var a=i,c=0,l=void 0,s=void 0,o=function(v,g){z[c]=v,z[c+1]=g,c+=2,c===2&&(s?s(B):me())};function u(p){s=p}function f(p){o=p}var d=typeof window<"u"?window:void 0,m=d||{},h=m.MutationObserver||m.WebKitMutationObserver,T=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",N=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function y(){return function(){return process.nextTick(B)}}function S(){return typeof l<"u"?function(){l(B)}:O()}function j(){var p=0,v=new h(B),g=document.createTextNode("");return v.observe(g,{characterData:!0}),function(){g.data=p=++p%2}}function F(){var p=new MessageChannel;return p.port1.onmessage=B,function(){return p.port2.postMessage(0)}}function O(){var p=setTimeout;return function(){return p(B,1)}}var z=new Array(1e3);function B(){for(var p=0;p<c;p+=2){var v=z[p],g=z[p+1];v(g),z[p]=void 0,z[p+1]=void 0}c=0}function q(){try{var p=Function("return this")().require("vertx");return l=p.runOnLoop||p.runOnContext,S()}catch{return O()}}var me=void 0;T?me=y():h?me=j():N?me=F():d===void 0&&typeof Xr=="function"?me=q():me=O();function _(p,v){var g=this,E=new this.constructor(pe);E[de]===void 0&&zr(E);var b=g._state;if(b){var A=arguments[b-1];o(function(){return J(b,E,A,g._result)})}else Ve(g,E,p,v);return E}function Ie(p){var v=this;if(p&&typeof p=="object"&&p.constructor===v)return p;var g=new v(pe);return Ce(g,p),g}var de=Math.random().toString(36).substring(2);function pe(){}var X=void 0,ve=1,he=2;function _e(){return new TypeError("You cannot resolve a promise with itself")}function le(){return new TypeError("A promises callback cannot return that same promise.")}function tt(p,v,g,E){try{p.call(v,g,E)}catch(b){return b}}function rt(p,v,g){o(function(E){var b=!1,A=tt(g,v,function(H){b||(b=!0,v!==H?Ce(E,H):ie(E,H))},function(H){b||(b=!0,G(E,H))},"Settle: "+(E._label||" unknown promise"));!b&&A&&(b=!0,G(E,A))},p)}function Be(p,v){v._state===ve?ie(p,v._result):v._state===he?G(p,v._result):Ve(v,void 0,function(g){return Ce(p,g)},function(g){return G(p,g)})}function ze(p,v,g){v.constructor===p.constructor&&g===_&&v.constructor.resolve===Ie?Be(p,v):g===void 0?ie(p,v):n(g)?rt(p,v,g):ie(p,v)}function Ce(p,v){if(p===v)G(p,_e());else if(r(v)){var g=void 0;try{g=v.then}catch(E){G(p,E);return}ze(p,v,g)}else ie(p,v)}function ye(p){p._onerror&&p._onerror(p._result),We(p)}function ie(p,v){p._state===X&&(p._result=v,p._state=ve,p._subscribers.length!==0&&o(We,p))}function G(p,v){p._state===X&&(p._state=he,p._result=v,o(ye,p))}function Ve(p,v,g,E){var b=p._subscribers,A=b.length;p._onerror=null,b[A]=v,b[A+ve]=g,b[A+he]=E,A===0&&p._state&&o(We,p)}function We(p){var v=p._subscribers,g=p._state;if(v.length!==0){for(var E=void 0,b=void 0,A=p._result,H=0;H<v.length;H+=3)E=v[H],b=v[H+g],E?J(g,E,b,A):b(A);p._subscribers.length=0}}function J(p,v,g,E){var b=n(g),A=void 0,H=void 0,Le=!0;if(b){try{A=g(E)}catch(at){Le=!1,H=at}if(v===A){G(v,le());return}}else A=E;v._state!==X||(b&&Le?Ce(v,A):Le===!1?G(v,H):p===ve?ie(v,A):p===he&&G(v,A))}function nt(p,v){try{v(function(E){Ce(p,E)},function(E){G(p,E)})}catch(g){G(p,g)}}var it=0;function ni(){return it++}function zr(p){p[de]=it++,p._state=void 0,p._result=void 0,p._subscribers=[]}function ii(){return new Error("Array Methods must be provided an Array")}var ai=function(){function p(v,g){this._instanceConstructor=v,this.promise=new v(pe),this.promise[de]||zr(this.promise),a(g)?(this.length=g.length,this._remaining=g.length,this._result=new Array(this.length),this.length===0?ie(this.promise,this._result):(this.length=this.length||0,this._enumerate(g),this._remaining===0&&ie(this.promise,this._result))):G(this.promise,ii())}return p.prototype._enumerate=function(g){for(var E=0;this._state===X&&E<g.length;E++)this._eachEntry(g[E],E)},p.prototype._eachEntry=function(g,E){var b=this._instanceConstructor,A=b.resolve;if(A===Ie){var H=void 0,Le=void 0,at=!1;try{H=g.then}catch(At){at=!0,Le=At}if(H===_&&g._state!==X)this._settledAt(g._state,E,g._result);else if(typeof H!="function")this._remaining--,this._result[E]=g;else if(b===te){var bt=new b(pe);at?G(bt,Le):ze(bt,g,H),this._willSettleAt(bt,E)}else this._willSettleAt(new b(function(At){return At(g)}),E)}else this._willSettleAt(A(g),E)},p.prototype._settledAt=function(g,E,b){var A=this.promise;A._state===X&&(this._remaining--,g===he?G(A,b):this._result[E]=b),this._remaining===0&&ie(A,this._result)},p.prototype._willSettleAt=function(g,E){var b=this;Ve(g,void 0,function(A){return b._settledAt(ve,E,A)},function(A){return b._settledAt(he,E,A)})},p}();function si(p){return new ai(this,p).promise}function oi(p){var v=this;return a(p)?new v(function(g,E){for(var b=p.length,A=0;A<b;A++)v.resolve(p[A]).then(g,E)}):new v(function(g,E){return E(new TypeError("You must pass an array to race."))})}function ci(p){var v=this,g=new v(pe);return G(g,p),g}function ui(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function li(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var te=function(){function p(v){this[de]=ni(),this._result=this._state=void 0,this._subscribers=[],pe!==v&&(typeof v!="function"&&ui(),this instanceof p?nt(this,v):li())}return p.prototype.catch=function(g){return this.then(null,g)},p.prototype.finally=function(g){var E=this,b=E.constructor;return n(g)?E.then(function(A){return b.resolve(g()).then(function(){return A})},function(A){return b.resolve(g()).then(function(){throw A})}):E.then(g,g)},p}();te.prototype.then=_,te.all=si,te.race=oi,te.resolve=Ie,te.reject=ci,te._setScheduler=u,te._setAsap=f,te._asap=o;function fi(){var p=void 0;if(typeof ct<"u")p=ct;else if(typeof self<"u")p=self;else try{p=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var v=p.Promise;if(v){var g=null;try{g=Object.prototype.toString.call(v.resolve())}catch{}if(g==="[object Promise]"&&!v.cast)return}p.Promise=te}return te.polyfill=fi,te.Promise=te,te})});class Hn extends an{constructor(e){super("RTCPusherPlayer"),this.TAG="[RTCPusherPlayer]";let r={element:null,debug:!1,zlmsdpUrl:"",simulcast:!1,useCamera:!0,audioEnable:!0,videoEnable:!0,recvOnly:!1,resolution:{w:0,h:0},usedatachannel:!1,videoId:"",audioId:""};this.options=Object.assign({},r,e),this.options.debug&&nn(),this.e={onicecandidate:this._onIceCandidate.bind(this),ontrack:this._onTrack.bind(this),onicecandidateerror:this._onIceCandidateError.bind(this),onconnectionstatechange:this._onconnectionstatechange.bind(this),ondatachannelopen:this._onDataChannelOpen.bind(this),ondatachannelmsg:this._onDataChannelMsg.bind(this),ondatachannelerr:this._onDataChannelErr.bind(this),ondatachannelclose:this._onDataChannelClose.bind(this)},this._remoteStream=null,this._localStream=null,this._tracks=[],this.pc=new RTCPeerConnection(null),this.pc.onicecandidate=this.e.onicecandidate,this.pc.onicecandidateerror=this.e.onicecandidateerror,this.pc.ontrack=this.e.ontrack,this.pc.onconnectionstatechange=this.e.onconnectionstatechange,this.datachannel=null,this.options.usedatachannel&&(this.datachannel=this.pc.createDataChannel("chat"),this.datachannel.onclose=this.e.ondatachannelclose,this.datachannel.onerror=this.e.ondatachannelerr,this.datachannel.onmessage=this.e.ondatachannelmsg,this.datachannel.onopen=this.e.ondatachannelopen),!this.options.recvOnly&&(this.options.audioEnable||this.options.videoEnable)?this.start():this.receive()}receive(){const e={direction:"recvonly",sendEncodings:[]},r={direction:"recvonly",sendEncodings:[]};this.options.videoEnable&&this.pc.addTransceiver("video",r),this.options.audioEnable&&this.pc.addTransceiver("audio",e),this.pc.createOffer().then(n=>{ce(this.TAG,"offer:",n.sdp),this.pc.setLocalDescription(n).then(()=>{Ur({method:"post",url:this.options.zlmsdpUrl,responseType:"json",data:n.sdp,headers:{"Content-Type":"text/plain;charset=utf-8"}}).then(i=>{let a=i.data;if(a.code!=0){this.dispatch(I.WEBRTC_OFFER_ANWSER_EXCHANGE_FAILED,a);return}let c={};c.sdp=a.sdp,c.type="answer",ce(this.TAG,"answer:",a.sdp),this.pc.setRemoteDescription(c).then(()=>{ce(this.TAG,"set remote sucess")}).catch(l=>{ge(this.TAG,l)})})})}).catch(n=>{ge(this.TAG,n)})}start(){let e=!1,r=!1;this.options.useCamera?(this.options.videoEnable&&(e=new Se(U.CAMERA)),this.options.audioEnable&&(r=new Ae(x.MIC)),typeof e=="object"&&this.options.videoId!=""&&(e.deviceId=this.options.videoId),typeof r=="object"&&this.options.audioId!=""&&(r.deviceId=this.options.audioId)):this.options.videoEnable?(e=new Se(U.SCREENCAST),this.options.audioEnable&&(r=new Ae(x.SCREENCAST))):(this.options.audioEnable?r=new Ae(x.MIC):ge(this.TAG,"error paramter"),typeof r=="object"&&this.options.audioId!=""&&(r.deviceId=this.options.audioId)),this.options.resolution.w!=0&&this.options.resolution.h!=0&&typeof e=="object"&&(e.resolution=new se(this.options.resolution.w,this.options.resolution.h)),Oe.createMediaStream(new ke(r,e)).then(n=>{this._localStream=n,this.dispatch(I.WEBRTC_ON_LOCAL_STREAM,n);const i={direction:"sendrecv",sendEncodings:[]},a={direction:"sendrecv",sendEncodings:[]};this.options.simulcast&&n.getVideoTracks().length>0&&(a.sendEncodings=[{rid:"h",active:!0,maxBitrate:1e6},{rid:"m",active:!0,maxBitrate:5e5,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:2e5,scaleResolutionDownBy:4}]),this.options.audioEnable&&(n.getAudioTracks().length>0?this.pc.addTransceiver(n.getAudioTracks()[0],i):(i.direction="recvonly",this.pc.addTransceiver("audio",i))),this.options.videoEnable&&(n.getVideoTracks().length>0?this.pc.addTransceiver(n.getVideoTracks()[0],a):(a.direction="recvonly",this.pc.addTransceiver("video",a))),this.pc.createOffer().then(c=>{ce(this.TAG,"offer:",c.sdp),this.pc.setLocalDescription(c).then(()=>{Ur({method:"post",url:this.options.zlmsdpUrl,responseType:"json",data:c.sdp,headers:{"Content-Type":"text/plain;charset=utf-8"}}).then(l=>{let s=l.data;if(s.code!=0){this.dispatch(I.WEBRTC_OFFER_ANWSER_EXCHANGE_FAILED,s);return}let o={};o.sdp=s.sdp,o.type="answer",ce(this.TAG,"answer:",s.sdp),this.pc.setRemoteDescription(o).then(()=>{ce(this.TAG,"set remote sucess")}).catch(u=>{ge(this.TAG,u)})})})}).catch(c=>{ge(this.TAG,c)})}).catch(n=>{this.dispatch(I.CAPTURE_STREAM_FAILED),ge(this.TAG,n)})}_onIceCandidate(e){e.candidate&&ce(this.TAG,`Remote ICE candidate: 
 `+e.candidate.candidate)}_onTrack(e){this._tracks.push(e.track),this.options.element&&e.streams&&e.streams.length>0?(this.options.element.srcObject=e.streams[0],this._remoteStream=e.streams[0],this.dispatch(I.WEBRTC_ON_REMOTE_STREAMS,this._remoteStream)):this.pc.getReceivers().length==this._tracks.length?(ce(this.TAG,"play remote stream "),this._remoteStream=new MediaStream(this._tracks),this.options.element&&(this.options.element.srcObject=this._remoteStream),this.dispatch(I.WEBRTC_ON_REMOTE_STREAMS,this._remoteStream)):ge(this.TAG,"wait stream track finish")}_onIceCandidateError(e){this.dispatch(I.WEBRTC_ICE_CANDIDATE_ERROR,e)}_onconnectionstatechange(e){this.dispatch(I.WEBRTC_ON_CONNECTION_STATE_CHANGE,this.pc.connectionState)}_onDataChannelOpen(e){ce(this.TAG,"ondatachannel open:",e),this.dispatch(I.WEBRTC_ON_DATA_CHANNEL_OPEN,e)}_onDataChannelMsg(e){ce(this.TAG,"ondatachannel msg:",e),this.dispatch(I.WEBRTC_ON_DATA_CHANNEL_MSG,e)}_onDataChannelErr(e){ce(this.TAG,"ondatachannel err:",e),this.dispatch(I.WEBRTC_ON_DATA_CHANNEL_ERR,e)}_onDataChannelClose(e){ce(this.TAG,"ondatachannel close:",e),this.dispatch(I.WEBRTC_ON_DATA_CHANNEL_CLOSE,e)}sendMsg(e){this.datachannel!=null?this.datachannel.send(e):ge(this.TAG,"data channel is null")}switchVideo(e,r){let n=!1;return e?(n=new Se(U.CAMERA),n.deviceId=r):n=new Se(U.SCREENCAST),Oe.createMediaStream(new ke(!1,n)).then(i=>{const a=this.pc.getSenders().find(c=>c.track.kind==="video");return a!=null&&i.getVideoTracks().length>0?(this._localStream.removeTrack(a.track),this._localStream.addTrack(i.getVideoTracks()[0]),this.dispatch(I.WEBRTC_ON_LOCAL_STREAM,this._localStream),a.replaceTrack(i.getVideoTracks()[0])):Br.Promise.reject("video not exist or deviceid not vaild")})}switcAudio(e,r){let n=!1;return e?(n=new Ae(x.MIC),n.deviceId=r):n=new Ae(x.SCREENCAST),Oe.createMediaStream(new ke(n,!1)).then(i=>{const a=this.pc.getSenders().find(c=>c.track.kind==="audio");return a!=null&&i.getAudioTracks().length>0?(this._localStream.removeTrack(a.track),this._localStream.addTrack(i.getAudioTracks()[0]),this.dispatch(I.WEBRTC_ON_LOCAL_STREAM,this._localStream),a.replaceTrack(i.getAudioTracks()[0])):Br.Promise.reject("audio not exist or deviceid not vaild")})}closeDataChannel(){this.datachannel&&(this.datachannel.close(),this.datachannel=null)}close(){this.closeDataChannel(),this.pc&&(this.pc.close(),this.pc=null),this.options&&(this.options=null),this._localStream&&this._localStream.getTracks().forEach((e,r)=>{e.stop()}),this._remoteStream&&this._remoteStream.getTracks().forEach((e,r)=>{e.stop()}),this._tracks.forEach((e,r)=>{e.stop()}),this._tracks=[]}get remoteStream(){return this._remoteStream}get localStream(){return this._localStream}}const Re=[{label:"4K(UHD)",width:3840,height:2160},{label:"1080p(FHD)",width:1920,height:1080},{label:"UXGA",width:1600,height:1200,ratio:"4:3"},{label:"720p(HD)",width:1280,height:720},{label:"SVGA",width:800,height:600},{label:"VGA",width:640,height:480},{label:"360p(nHD)",width:640,height:360},{label:"CIF",width:352,height:288},{label:"QVGA",width:320,height:240},{label:"QCIF",width:176,height:144},{label:"QQVGA",width:160,height:120}];function Jn(){return new Promise(function(t,e){let r=[],n=0,i=0;for(let a=0;a<Re.length;++a){let c=new Se(U.CAMERA);c.resolution=new se(Re[a].width,Re[a].height),Oe.createMediaStream(new ke(!1,c)).then(l=>{l.getVideoTracks().forEach(s=>s.stop()),r.push(Re[a]),n++,n+i==Re.length&&t(r)}).catch(l=>{i++,n+i==Re.length&&t(r)})}})}function $n(){return Re}function Kn(t,e){return new Promise(function(r,n){let i=new Se(U.CAMERA);i.resolution=new se(t,e),Oe.createMediaStream(new ke(!1,i)).then(a=>{a.getVideoTracks().forEach(c=>c.stop()),r()}).catch(a=>{n(a)})})}function Xn(){return new Promise(function(t,e){typeof navigator.mediaDevices!="object"||typeof navigator.mediaDevices.enumerateDevices!="function"?e("enumerateDevices() not supported."):navigator.mediaDevices.enumerateDevices().then(r=>{t(r)}).catch(r=>{e(`${r.name}: ${r.message}`)})})}console.log("build date:",Q),console.log("version:",V);const Qn=I,Yn=rn,Zn=Hn,wn=Jn,ei=$n,ti=Kn,ri=Xn;return $.Endpoint=Zn,$.Events=Qn,$.GetAllMediaDevice=ri,$.GetAllScanResolution=ei,$.GetSupportCameraResolutions=wn,$.Media=Yn,$.isSupportResolution=ti,Object.defineProperty($,"__esModule",{value:!0}),$}({});const mi=["controls"],vi={__name:"webRTCVideo",props:{url:{type:String,required:!0},enableFullscreen:{type:Boolean,default:!0},showControls:{type:Boolean,default:!0}},emits:["error"],setup($,{emit:I}){const V=$,Q=I,ae=D(null),P=D(null),Z=D(""),x=D(!1),U=()=>{x.value?V.enableFullscreen&&se():V.enableFullscreen&&ue()},ue=()=>{const Y=ae.value;Y.requestFullscreen?Y.requestFullscreen():Y.webkitRequestFullscreen?Y.webkitRequestFullscreen():Y.mozRequestFullScreen?Y.mozRequestFullScreen():Y.msRequestFullscreen&&Y.msRequestFullscreen()},se=()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},W=()=>{x.value=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)},oe=()=>{document.addEventListener("fullscreenchange",W),document.addEventListener("webkitfullscreenchange",W),document.addEventListener("mozfullscreenchange",W),document.addEventListener("MSFullscreenChange",W)},re=()=>{document.removeEventListener("fullscreenchange",W),document.removeEventListener("webkitfullscreenchange",W),document.removeEventListener("mozfullscreenchange",W),document.removeEventListener("MSFullscreenChange",W)},w=async Y=>{P.value=new fe.Endpoint({element:ae.value,debug:!0,zlmsdpUrl:Y,simulcast:!1,useCamera:!1,audioEnable:!0,videoEnable:!0,recvOnly:!0}),P.value.on(fe.Events.WEBRTC_ICE_CANDIDATE_ERROR,function(L){console.log("ICE "),Z.value+=`ICE  : ${JSON.stringify(L)}`,Q("error",Z.value)}),P.value.on(fe.Events.WEBRTC_ON_REMOTE_STREAMS,function(L){console.log("",L)}),P.value.on(fe.Events.WEBRTC_OFFER_ANWSER_EXCHANGE_FAILED,function(L){console.log("offer anwser ",L),Z.value+=`offer anwser : ${JSON.stringify(L)}`,Q("error",Z.value),stop()}),P.value.on(fe.Events.WEBRTC_ON_LOCAL_STREAM,function(L){}),P.value.on(fe.Events.CAPTURE_STREAM_FAILED,function(L){console.log(""),Z.value+=`: ${JSON.stringify(L)}`,Q("error",Z.value)}),P.value.on(fe.Events.WEBRTC_ON_CONNECTION_STATE_CHANGE,function(L){console.log("==>",L)}),P.value.on(fe.Events.WEBRTC_ON_DATA_CHANNEL_OPEN,function(L){console.log("rtc datachannel  :",L)}),P.value.on(fe.Events.WEBRTC_ON_DATA_CHANNEL_MSG,function(L){console.log("rtc datachannel  :",L.data)}),P.value.on(fe.Events.WEBRTC_ON_DATA_CHANNEL_ERR,function(L){console.log("rtc datachannel  :",L)}),P.value.on(fe.Events.WEBRTC_ON_DATA_CHANNEL_CLOSE,function(L){console.log("rtc datachannel  :",L)})};return Ot(()=>{qr(()=>{w(V.url),V.enableFullscreen&&oe()})}),Hr(()=>{V.enableFullscreen&&re()}),(Y,L)=>(Te(),je("video",{class:"video-player",controls:$.showControls,autoplay:"",muted:"",ref_key:"videoPlayerRef",ref:ae,controlsList:"nodownload nofullscreen noremoteplayback",disablePictureInPicture:"true",onDblclick:U},null,40,mi))}},gi=Wr(vi,[["__scopeId","data-v-9538272b"]]),Ci={class:"root"},yi={key:0},Ti={__name:"Jessibuca3",props:{flvUrl:String,TVStyle:Object,videoElement:String,videonumber:[String,Number],isH265:Boolean,asm4:String,wasm4:String,isDblclickFullscreen:{type:Boolean,default:!0}},emits:["error"],setup($,{emit:I}){const V=$,Q=I,ae=D(null),P=D(null);D(""),D(!1),D("ff");const Z=D(!1),x=D(!0),U=D(!1),ue=D(!1),se=D(!1),W=D("");D(0);const oe=D("");D(1),D(0);const re=D(!1),w=D(!0),Y=D(!1);D(!1),D("webm"),D(0);const L=ne=>{ne=ne||{},console.log(window.Jessibuca),P.value=new window.Jessibuca(Object.assign({container:ae.value,videoBuffer:2,isResize:!1,useWCS:re.value,useMSE:w.value,text:"",loadingText:"...",debug:!1,supportDblclickFullscreen:V.isDblclickFullscreen??!0,showBandwidth:se.value,operateBtns:{fullscreen:ue.value,screenshot:ue.value,play:ue.value,audio:ue.value},vod:!1,forceNoOffscreen:!Y.value,isNotMute:!0,timeout:10},ne)),P.value.on("load",function(){console.log("on load")}),P.value.on("log",function(k){console.log("on log",k)}),P.value.on("record",function(k){console.log("on record:",k)}),P.value.on("pause",function(){console.log("on pause"),Z.value=!1}),P.value.on("play",function(){console.log("on play"),Z.value=!0}),P.value.on("fullscreen",function(k){console.log("on fullscreen",k)}),P.value.on("mute",function(k){console.log("on mute",k),x.value=k}),P.value.on("mute",function(k){console.log("on mute2",k)}),P.value.on("audioInfo",function(k){console.log("audioInfo",k)}),P.value.on("videoInfo",function(k){console.log("videoInfo",k)}),P.value.on("error",function(k){console.log("error",k),Q("error",k)}),P.value.on("timeout",function(){console.log("timeout"),Q("error","timeout")}),P.value.on("start",function(){console.log("frame start")}),P.value.on("performance",function(k){var be="";k===2?be="":k===1&&(be=""),console.log("",be),oe.value=""}),P.value.on("buffer",function(k){console.log("buffer",k)}),P.value.on("stats",function(k){console.log("stats",k)}),P.value.on("kBps",function(k){console.log("kBps",k)}),P.value.on("play",()=>{Z.value=!0,U.value=!0,x.value=P.value.isMute()}),P.value.on("recordingTimestamp",k=>{console.log("recordingTimestamp",k)})},Pe=()=>{console.log("this.flvUrl"),console.log(V.flvUrl),P.value.play(V.flvUrl)};return di(()=>V.flvUrl,ne=>{ne&&Pe()}),Ot(()=>{L(),window.onerror=ne=>W.value=ne,Pe()}),Hr(async()=>{P.value&&await P.value.destroy()}),(ne,k)=>(Te(),je("div",Ci,[kt("div",{id:"container",ref_key:"container",ref:ae,style:pi($.TVStyle)},[oe.value?(Te(),je("span",yi,""+Jr(oe.value),1)):qe("",!0)],4)]))}},Si={class:"video-player-container"},Ei={key:1,class:"tip-content"},Ri={class:"tip-content-message"},_i={__name:"index",setup($){const I=D(""),V=D(""),Q=D("");D(null);const ae=x=>{I.value=x},P=()=>{const x=window.location.href,U=x.match(/[?&]urlType=([^&]*)/),ue=x.match(/[?&]url=(.*?)(?:$|\s)/),se=U?decodeURIComponent(U[1]):"",W=ue?decodeURIComponent(ue[1]):"";console.log("urlType",se),console.log("streamUrl",W);let oe="";if(console.log("window.location",window.location),se==="rtc"){const re=W.indexOf(":21003"),w=W.slice(re);oe=window.location.protocol+"//"+window.location.hostname+w}else{const re=W.indexOf("/rtp"),w=W.slice(re);oe=window.location.origin+w}V.value=se,Q.value=oe,console.log("url",Q.value),Z()},Z=()=>{const x=[];V.value?["rtc","h264","h265"].includes(V.value)||x.push("urlTypeurlTypertch264h265"):x.push("urlType"),Q.value||x.push("url"),I.value=x.join("")};return Ot(()=>{qr(()=>{P()})}),(x,U)=>(Te(),je("div",Si,[Q.value?(Te(),je(hi,{key:0},[V.value==="rtc"?(Te(),Vr(gi,{key:0,url:Q.value,onError:ae},null,8,["url"])):qe("",!0),V.value==="h264"||V.value==="h265"?(Te(),Vr(Ti,{key:1,flvUrl:Q.value,style:{width:"100%",height:"100%"},onError:ae},null,8,["flvUrl"])):qe("",!0)],64)):qe("",!0),I.value?(Te(),je("div",Ei,[U[0]||(U[0]=kt("div",{class:"tip-content-title"},"  ",-1)),kt("div",Ri,Jr(I.value),1)])):qe("",!0)]))}},bi=Wr(_i,[["__scopeId","data-v-20fe0745"]]);export{bi as default};
